<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pi像素方格游戏</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- 统一的 Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FFC107',
                        secondary: '#6C757D',
                        success: '#28A745',
                        danger: '#DC3545',
                        warning: '#FFC107',
                        info: '#17A2B8',
                        dark: '#343A40',
                        light: '#F8F9FA',
                        'pi-yellow': '#FFC107',
                        'pi-purple': '#7B1FA2',
                        'pixel-dark': '#121212',
                        'pixel-light': '#FFFFFF'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        pixel: ['"Press Start 2P"', 'monospace']
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .pixel-borders {
                box-shadow: 
                    -4px 0 0 0 #000,
                    4px 0 0 0 #000,
                    0 -4px 0 0 #000,
                    0 4px 0 0 #000;
            }
            .glow-border {
                box-shadow: 
                    inset -2px 0 0 0 #FFC107,
                    inset 2px 0 0 0 #FFC107,
                    inset 0 -2px 0 0 #FFC107,
                    inset 0 2px 0 0 #FFC107,
                    0 0 10px 2px rgba(255, 193, 7, 0.5);
            }
            .pixel-button {
                @apply relative px-4 py-2 bg-primary text-black font-pixel text-sm transform transition-all duration-150 hover:brightness-110 active:translate-y-1 active:brightness-90;
                box-shadow: 
                    3px 3px 0 0 #000,
                    inset 3px 3px 0 0 rgba(255,255,255,0.5),
                    inset -3px -3px 0 0 rgba(0,0,0,0.5);
            }
            .pixel-button:active {
                box-shadow: 
                    1px 1px 0 0 #000,
                    inset 3px 3px 0 0 rgba(0,0,0,0.5),
                    inset -3px -3px 0 0 rgba(255,255,255,0.5);
            }
            .advanced-button {
                @apply relative px-3 py-1 bg-gradient-to-br from-gray-700 to-gray-900 text-white rounded-lg transform transition-all duration-200 hover:shadow-lg hover:scale-105 active:scale-95 active:brightness-90;
                box-shadow: 
                    0 4px 6px -1px rgba(0, 0, 0, 0.1),
                    0 2px 4px -1px rgba(0, 0, 0, 0.06),
                    inset 0 1px 0 0 rgba(255,255,255,0.1);
            }
            .advanced-button:hover {
                box-shadow: 
                    0 10px 15px -3px rgba(0, 0, 0, 0.2),
                    0 4px 6px -2px rgba(0, 0, 0, 0.1),
                    inset 0 1px 0 0 rgba(255,255,255,0.2);
            }
            .advanced-button:active {
                box-shadow: 
                    0 1px 3px 0 rgba(0, 0, 0, 0.1),
                    0 1px 2px 0 rgba(0, 0, 0, 0.06),
                    inset 0 1px 0 0 rgba(0,0,0,0.1);
            }
            .color-picker {
                @apply w-7 h-7 border-2 border-black cursor-pointer transition-transform hover:scale-110;
            }
            .grid-bg {
                background-size: 20px 20px;
                background-image: 
                    linear-gradient(to right, rgba(255,255,255,0.05) 1px, transparent 1px),
                    linear-gradient(to bottom, rgba(255,255,255,0.05) 1px, transparent 1px);
            }
        }
    </style>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #121212;
            color: #ffffff;
            overflow-x: hidden;
        }
        
        .pixel-font {
            font-family: 'Press Start 2P', monospace;
        }
        
        /* 正方形画布容器 */
        .pixel-map-container {
            position: relative;
            overflow: hidden;
            background-color: #000;
            border: 2px solid #333;
            width: 90vw;
            height: 90vw;
            max-width: 80vh;
            max-height: 80vh;
            margin: 0 auto;
        }
        
        /* 手机适配 */
        @media (max-width: 768px) {
            .pixel-map-container {
                max-height: 60vh;
            }
        }
        
        #pixelMap {
            display: block;
            margin: 0 auto;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        .map-controls {
            position: sticky;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 10;
            background: rgba(0,0,0,0.8);
            padding: 5px;
            border-radius: 8px;
        }
        
        .zoom-controls {
            position: sticky;
            top: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            z-index: 10;
            background: rgba(0,0,0,0.8);
            padding: 5px;
            border-radius: 8px;
        }
        
        .color-palette {
            display: flex;
            gap: 3px;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.8);
            border: 1px solid #333;
            border-radius: 5px;
            overflow-x: auto;
            white-space: nowrap;
        }
        
        .selected-pixel-info {
            background-color: rgba(0, 0, 0, 0.8);
            border: 1px solid #333;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
        }
        
        .wallet-info {
            background-color: rgba(0, 0, 0, 0.8);
            border: 1px solid #333;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .pi-logo {
            width: 30px;
            height: 30px;
        }
        
        .transaction-history {
            max-height: 300px;
            overflow-y: auto;
            background-color: rgba(0, 0, 0, 0.8);
            border: 1px solid #333;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
        }
        
        .transaction-item {
            padding: 5px 0;
            border-bottom: 1px solid #333;
            font-size: 12px;
        }
        
        .transaction-item:last-child {
            border-bottom: none;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            z-index: 100;
            display: none;
        }
        
        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* 加载动画 */
        .loading {
            display: inline-block;
            position: relative;
            width: 80px;
            height: 80px;
        }
        
        .loading div {
            position: absolute;
            top: 33px;
            width: 13px;
            height: 13px;
            border-radius: 50%;
            background: #FFC107;
            animation-timing-function: cubic-bezier(0, 1, 1, 0);
        }
        
        .loading div:nth-child(1) {
            left: 8px;
            animation: loading1 0.6s infinite;
        }
        
        .loading div:nth-child(2) {
            left: 8px;
            animation: loading2 0.6s infinite;
        }
        
        .loading div:nth-child(3) {
            left: 32px;
            animation: loading2 0.6s infinite;
        }
        
        .loading div:nth-child(4) {
            left: 56px;
            animation: loading3 0.6s infinite;
        }
        
        @keyframes loading1 {
            0% {
                transform: scale(0);
            }
            100% {
                transform: scale(1);
            }
        }
        
        @keyframes loading3 {
            0% {
                transform: scale(1);
            }
            100% {
                transform: scale(0);
            }
        }
        
        @keyframes loading2 {
            0% {
                transform: translate(0, 0);
            }
            100% {
                transform: translate(24px, 0);
            }
        }

        /* 公告滚动动画 */
        @keyframes marquee {
            0% {
                transform: translateX(100%);
            }
            100% {
                transform: translateX(-100%);
            }
        }

        .animate-marquee {
            animation: marquee 30s linear infinite;
        }
        
        /* 像素块悬停效果 */
        .pixel-hover {
            filter: brightness(1.2);
            transition: filter 0.1s;
        }
        
        /* 通知样式 */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            background-color: #333;
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background-color: #28A745;
        }
        
        .notification.error {
            background-color: #DC3545;
        }
        
        .notification.info {
            background-color: #17A2B8;
        }

        /* 页面切换动画 */
        .page {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="min-h-screen bg-pixel-dark text-white">
    <!-- 顶部导航栏 -->
    <header class="bg-black border-b border-gray-800 py-4 px-6">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <h1 class="text-2xl font-pixel text-pi-yellow" style="font-size: 20px; font-weight: normal;">Pi像素领地 </h1>
            </div>
            <div id="headerButtons">
                <!-- 首页特定按钮将在这里动态显示 -->
            </div>
        </div>
    </header>

    <!-- 主要内容区域 -->
    <main class="container mx-auto py-2 px-4">
        <!-- 首页 -->
        <div id="homePage" class="page active">
            <!-- 首页特定元素：签到按钮、登录按钮和公告滚动栏 -->
            <div id="homeSpecificElements">
                <!-- 公告滚动栏 -->
                <div class="bg-white text-black py-2 px-2 overflow-hidden whitespace-nowrap max-w-3xl mx-auto mb-2">
                    <div class="container mx-auto flex items-center">
                        <span class="font-bold mr-3" style="font-size: 14px; text-decoration: underline; font-style: normal; color: rgb(0, 0, 0);">    公告</span>
                        <div class="announcement-content inline-block animate-marquee" style="font-size: 14px; color: rgb(36, 25, 25); font-weight: bold;">
                            欢迎来到Pi像素方格游戏！ 新用户注册即送100π币！ 首次购买像素格享受8折优惠！ 更多活动敬请期待...
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex flex-col items-center">
                <!-- 像素地图 -->
                <div class="w-full max-w-full">
                    <div class="pixel-map-container relative mx-auto">
                        <!-- Canvas尺寸：100×20px = 2000px (对应100×13cm) -->
                        <canvas id="pixelMap" width="2000" height="2000" style="cursor: default;"></canvas>
                        
                        <!-- 控制按钮组 -->
                        <div class="absolute right-4 top-1/2 transform -translate-y-1/2 flex flex-col gap-2 z-10">
                            <button id="refreshBtn" class="bg-pi-yellow hover:bg-yellow-400 text-black w-10 h-10 rounded-full flex items-center justify-center shadow-lg transition-all duration-200 transform hover:scale-110 active:scale-95">
                                <i class="fa fa-refresh text-lg"></i>
                            </button>
                            <button id="zoomInBtn" class="bg-pi-yellow hover:bg-yellow-400 text-black w-10 h-10 rounded-full flex items-center justify-center shadow-lg transition-all duration-200 transform hover:scale-110 active:scale-95">
                                <i class="fa fa-plus text-lg"></i>
                            </button>
                            <button id="zoomOutBtn" class="bg-pi-yellow hover:bg-yellow-400 text-black w-10 h-10 rounded-full flex items-center justify-center shadow-lg transition-all duration-200 transform hover:scale-110 active:scale-95">
                                <i class="fa fa-minus text-lg"></i>
                            </button>
                        </div>
                        
                        <!-- 像素块信息弹窗 -->
                        <div id="pixelInfoModal" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-50">
                            <div class="bg-black p-4 rounded-lg border border-gray-700 max-w-xs w-full">
                                <h3 class="text-base font-pixel mb-2 text-white text-center">像素方格信息</h3>
                                
                                <!-- 基本信息 -->
                                <div class="mb-3">
                                    <!-- 坐标 -->
                                    <div class="mb-1">
                                        <p class="text-gray-400 mb-1 text-xs" style="font-weight: bold; color: rgb(250, 247, 247);">坐标</p>
                                        <p class="font-pixel text-base" id="modalPixelCoords">X: 0, Y: 0</p>
                                    </div>
                                    
                                    <!-- 状态和规格并排 -->
                                    <div class="flex gap-4 mb-1">
                                        <div class="flex-1">
                                            <p class="text-gray-400 mb-1 text-xs">状态</p>
                                            <p class="font-pixel text-sm" id="modalPixelStatus">平台股东权限绘制</p>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-gray-400 mb-1 text-xs">规格</p>
                                            <p class="font-pixel text-sm" id="modalPixelSpec">1×1 厘米</p>
                                        </div>
                                    </div>
                                    
                                    <!-- 价格 -->
                                    <div class="mb-1">
                                        <p class="text-gray-400 mb-1 text-xs" style="color: rgb(204, 216, 235);">价格</p>
                                        <p class="font-pixel text-white text-base" id="modalPixelPrice">31415926535 π</p>
                                    </div>
                                    
                                    <!-- 备注 -->
                                    <div class="mb-1">
                                        <p class="text-gray-400 mb-1 text-xs" style="color: rgb(195, 206, 217);">备注</p>
                                        <p class="font-pixel text-sm" id="modalPixelNote">归此平台生态方所有</p>
                                    </div>
                                </div>
                                
                                <!-- 分页控制 -->
                                <div class="flex items-center justify-between mt-4">
                                    <button id="prevRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(-1)">
                                        <i class="fa fa-arrow-left mr-2"></i>上一页
                                    </button>
                                    <span id="rankingPageInfo" class="text-white font-pixel text-lg">1-10 / 30</span>
                                    <button id="nextRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(1)">
                                        下一页<i class="fa fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                                
                                <!-- 交易历史 -->
                                <div class="mb-3">
                                    <h4 class="text-sm font-pixel mb-1 text-pi-yellow">历史购买记录</h4>
                                    <div id="transactionHistoryList" class="bg-gray-900 rounded p-1 max-h-24 overflow-y-auto">
                                        <!-- 交易历史记录将通过JavaScript动态生成 -->
                                    </div>
                                </div>
                                
                                <!-- 分页控制 -->
                                <div class="flex items-center justify-between mt-4">
                                    <button id="prevRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(-1)">
                                        <i class="fa fa-arrow-left mr-2"></i>上一页
                                    </button>
                                    <span id="rankingPageInfo" class="text-white font-pixel text-lg">1-10 / 30</span>
                                    <button id="nextRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(1)">
                                        下一页<i class="fa fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                                
                                <!-- 颜色选择器（仅在已购买时显示） -->
                                <div id="colorPickerContainer" class="mb-3 hidden">
                                    <h4 class="text-sm font-pixel mb-1 text-pi-yellow">选择颜色</h4>
                                    <div id="modalColorPalette" class="flex gap-1 justify-center overflow-x-auto pb-1">
                                        <!-- 颜色选项将通过JavaScript动态生成 -->
                                    </div>
                                </div>
                                
                                <!-- 分页控制 -->
                                <div class="flex items-center justify-between mt-4">
                                    <button id="prevRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(-1)">
                                        <i class="fa fa-arrow-left mr-2"></i>上一页
                                    </button>
                                    <span id="rankingPageInfo" class="text-white font-pixel text-lg">1-10 / 30</span>
                                    <button id="nextRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(1)">
                                        下一页<i class="fa fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                
                                <!-- 操作按钮 -->
                                <div class="flex gap-2">
                                    <button id="buyPixelBtn" class="flex-1 pixel-button bg-success text-white text-sm py-1">
                                        <i class="fa fa-shopping-cart mr-1"></i>购买
                                    </button>
                                    <button id="editColorBtn" class="flex-1 pixel-button bg-primary text-black text-sm py-1 hidden">
                                        <i class="fa fa-paint-brush mr-1"></i>上色
                                    </button>
                                    <button id="closeModalBtn" class="flex-1 pixel-button bg-gray-600 text-white text-sm py-1">
                                        <i class="fa fa-times mr-1"></i>关闭
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 统计信息 -->
                    <div class="mt-4">
                        <div id="statsContainer" class="bg-black bg-opacity-80 border border-gray-800 rounded-lg p-2 grid grid-cols-3 gap-2 text-center">
                            <div class="stat-item">
                                <p class="text-gray-400 text-xs mb-1" style="color: rgb(250, 250, 250);">总方格数量</p>
                                <p class="font-pixel text-pi-yellow text-sm" id="totalPixelsStat">10000</p>
                            </div>
                            <div class="stat-item">
                                <p class="text-gray-400 text-xs mb-1" style="color: rgb(250, 250, 250);">今日操作方格</p>
                                <p class="font-pixel text-white text-sm" id="emptyPixelsStat" style="color: rgb(12, 201, 25);">9,874</p>
                            </div>
                            <div class="stat-item">
                                <p class="text-gray-400 text-xs mb-1" style="color: rgb(242, 240, 240);">今日广告商</p>
                                <p class="font-pixel text-success text-sm" id="onSalePixelsStat">177</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 颜色选择器 -->
                    <div class="mt-4">
                        <div id="colorPalette" class="color-palette justify-center">
                            <!-- 颜色将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 全民收益页面 -->
        <div id="achievementsPage" class="page">
            <div class="flex flex-col items-center">
                <!-- 可上传图片区域 -->
                <div class="mb-2 w-full max-w-2xl mx-auto">
                    <div class="aspect-video bg-gray-800 border-2 border-dashed border-gray-600 rounded-lg flex flex-col items-center justify-center cursor-pointer hover:border-pi-yellow transition-colors" id="uploadArea">
                        <i class="fa fa-cloud-upload text-4xl text-gray-500 mb-2"></i>
                        <p class="text-gray-400 text-sm">点击上传长方形图片</p>
                        <p class="text-gray-500 text-xs mt-1">支持JPG、PNG格式</p>
                        <input type="file" id="imageUpload" accept="image/*" class="hidden" capture="camera">
                    </div>
                </div>
                
                <!-- 主要内容容器 -->
                <div class="w-full max-w-4xl bg-black bg-opacity-80 border border-gray-800 rounded-lg p-2">
                    <!-- 按钮区域 -->
                    <div class="mb-2">
                        <div class="flex justify-center gap-3 mb-1">
                            <button id="rankingButton" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 whitespace-nowrap" style="font-weight: bold;">像素方格排行榜</button>
                            <button id="dataFlowButton" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 whitespace-nowrap" style="font-weight: bold;">今日数据流量</button>
                        </div>
                        <div class="flex justify-center gap-3">
                            <button id="rankingButton2" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 whitespace-nowrap" style="font-weight: bold;">全国.派友社区</button>
                            <button id="dataFlowButton2" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 whitespace-nowrap" style="font-weight: bold;">web3广告</button>
                        </div>
                    </div>
                    
                    <!-- 排行榜模态框 -->
                    <div id="rankingModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden backdrop-blur-sm">
                        <div class="bg-black rounded-lg p-6 border border-gray-800 max-w-2xl w-full max-h-[80vh] overflow-y-auto transform transition-all duration-300 scale-95 opacity-0" id="rankingModalContent" style="box-shadow: 0 0 30px rgba(255, 193, 7, 0.3), inset 0 1px 0 0 rgba(255, 255, 255, 0.1);">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-xl font-pixel text-pi-yellow">全国派生态社区</h3>
                                <button id="closeRankingModalBtn" class="text-gray-400 hover:text-white text-2xl">
                                    <i class="fa fa-times"></i>
                                </button>
                            </div>
                            
                            <!-- 全国派生态社区信息 -->
                            <div class="space-y-3">
                                <div class="bg-gray-900 rounded-lg p-4">
                                    <h3 class="text-lg font-pixel text-pi-yellow mb-3 text-center">全国派生态社区分布</h3>
                                    
                                    <!-- 社区列表 -->
                                    <div class="space-y-2">
                                        <div class="grid grid-cols-3 gap-2 items-center border-b border-gray-700 pb-2">
                                            <div class="text-white font-pixel text-sm font-bold">北京社区</div>
                                            <div class="text-white font-pixel text-sm">北京市朝阳区中关村大街1号</div>
                                            <div class="text-pi-yellow font-pixel text-sm">138-0013-8000</div>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2 items-center border-b border-gray-700 pb-2">
                                            <div class="text-white font-pixel text-sm font-bold">上海社区</div>
                                            <div class="text-white font-pixel text-sm">上海市浦东新区张江高科技园区</div>
                                            <div class="text-pi-yellow font-pixel text-sm">139-0013-9000</div>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2 items-center border-b border-gray-700 pb-2">
                                            <div class="text-white font-pixel text-sm font-bold">广州社区</div>
                                            <div class="text-white font-pixel text-sm">广州市天河区珠江新城</div>
                                            <div class="text-pi-yellow font-pixel text-sm">137-0013-7000</div>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2 items-center border-b border-gray-700 pb-2">
                                            <div class="text-white font-pixel text-sm font-bold">深圳社区</div>
                                            <div class="text-white font-pixel text-sm">深圳市南山区科技园</div>
                                            <div class="text-pi-yellow font-pixel text-sm">136-0013-6000</div>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2 items-center border-b border-gray-700 pb-2">
                                            <div class="text-white font-pixel text-sm font-bold">杭州社区</div>
                                            <div class="text-white font-pixel text-sm">杭州市西湖区文三路</div>
                                            <div class="text-pi-yellow font-pixel text-sm">135-0013-5000</div>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2 items-center border-b border-gray-700 pb-2">
                                            <div class="text-white font-pixel text-sm font-bold">成都社区</div>
                                            <div class="text-white font-pixel text-sm">成都市高新区天府大道</div>
                                            <div class="text-pi-yellow font-pixel text-sm">134-0013-4000</div>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2 items-center border-b border-gray-700 pb-2">
                                            <div class="text-white font-pixel text-sm font-bold">武汉社区</div>
                                            <div class="text-white font-pixel text-sm">武汉市洪山区光谷软件园</div>
                                            <div class="text-pi-yellow font-pixel text-sm">133-0013-3000</div>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2 items-center border-b border-gray-700 pb-2">
                                            <div class="text-white font-pixel text-sm font-bold">西安社区</div>
                                            <div class="text-white font-pixel text-sm">西安市雁塔区科技路</div>
                                            <div class="text-pi-yellow font-pixel text-sm">132-0013-2000</div>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2 items-center border-b border-gray-700 pb-2">
                                            <div class="text-white font-pixel text-sm font-bold">南京社区</div>
                                            <div class="text-white font-pixel text-sm">南京市玄武区珠江路</div>
                                            <div class="text-pi-yellow font-pixel text-sm">131-0013-1000</div>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2 items-center">
                                            <div class="text-white font-pixel text-sm font-bold">重庆社区</div>
                                            <div class="text-white font-pixel text-sm">重庆市渝北区两江新区</div>
                                            <div class="text-pi-yellow font-pixel text-sm">130-0013-0000</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 社区服务信息 -->
                                <div class="bg-gray-900 rounded-lg p-4">
                                    <h4 class="text-md font-pixel text-pi-yellow mb-2">社区服务时间</h4>
                                    <div class="text-white font-pixel text-sm space-y-1">
                                        <p>周一至周五: 9:00 - 18:00</p>
                                        <p>周六至周日: 10:00 - 16:00</p>
                                        <p>节假日: 请提前咨询</p>
                                    </div>
                                </div>
                                
                                <!-- 联系邮箱 -->
                                <div class="bg-gray-900 rounded-lg p-4">
                                    <h4 class="text-md font-pixel text-pi-yellow mb-2">官方联系邮箱</h4>
                                    <p class="text-white font-pixel text-sm">
                                        <span class="text-pi-blue">contact@pi-ecosystem.com</span>
                                    </p>
                                </div>
                            </div>
                            
                            <div class="flex justify-center gap-3 mt-6">
                                <button id="closeRankingBtn" class="px-4 py-2 bg-pi-yellow text-black rounded-lg hover:bg-yellow-400 transition-colors">关闭</button>
                            </div>
                        </div>
                    </div>

                    <!-- 人均全民参与程度 -->
                    <div id="participationTable" class="mb-4">
                        <div class="bg-gray-900 rounded-lg p-2">
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left text-gray-300">
                                    <thead class="text-xs text-white uppercase bg-gray-800">
                                        <tr>
                                            <th scope="col" class="px-4 py-2" style="color: rgb(11, 212, 41);">今日详情</th>
                                            <th scope="col" class="px-4 py-2" style="font-weight: normal; font-size: 12px;">WBE广告</th>
                                            <th scope="col" class="px-4 py-2">下级收益</th>
                                            <th scope="col" class="px-4 py-2">平台分红</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="border-b border-gray-800 hover:bg-gray-900">
                                            <td class="px-4 py-2">数量</td>
                                            <td class="px-4 py-2">15条</td>
                                            <td class="px-4 py-2">99位</td>
                                            <td class="px-4 py-2">17689pi</td>
                                        </tr>
                                        <tr class="border-b border-gray-800 hover:bg-gray-900">
                                            <td class="px-4 py-2">数据</td>
                                            <td class="px-4 py-2">15条</td>
                                            <td class="px-4 py-2">55位</td>
                                            <td class="px-4 py-2">1200股</td>
                                        </tr>
                                        <tr class="border-b border-gray-800 hover:bg-gray-900">
                                            <td class="px-4 py-2">收益</td>
                                            <td class="px-4 py-2">1.66pi</td>
                                            <td class="px-4 py-2">77  pi</td>
                                            <td class="px-4 py-2">188  pi</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 个人中心页面 -->
        <div id="profilePage" class="page">
            <div class="flex flex-col items-center">
                <h2 class="text-3xl font-pixel text-pi-yellow mb-1 text-center" style="font-weight: bold;">个人中心</h2>
                
                <!-- 个人中心内容区域 -->
                <div class="w-full max-w-4xl bg-black bg-opacity-80 border border-gray-800 rounded-lg p-2 min-h-[50vh]">
                    <!-- 派币资产区域 -->
                    <div class="mb-4">
                        <div class="bg-gray-900 p-3 rounded-lg">
                            <div class="mb-3">
                                <label class="block text-gray-400 text-sm mb-1">派币数量</label>
                                <div class="flex items-center">
                                    <input type="text" value="1,234.56 PI" class="flex-1 bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white font-pixel overflow-x-auto" readonly="" style="max-width: 200px;">
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button id="rechargeBtn" class="flex-1 py-1.5 bg-success text-white rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105 active:scale-95 flex items-center justify-center text-sm">
                                    <i class="fa fa-plus-circle mr-1"></i>充值
                                </button>
                                <button id="withdrawBtn" class="flex-1 py-1.5 bg-primary text-black rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105 active:scale-95 flex items-center justify-center text-sm">
                                    <i class="fa fa-minus-circle mr-1"></i>提现
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 今日收益区域 -->
                    <div class="mb-3">
                        <div class="bg-gray-900 p-1.5 rounded-lg">
                            <div class="grid grid-cols-2 gap-1.5 max-w-md mx-auto">
                                <div class="bg-success bg-opacity-20 p-1.5 rounded-lg border border-success cursor-pointer hover:bg-success hover:bg-opacity-30 transition-all duration-200 transform hover:scale-105" id="platformShareholdersBtn">
                                    <p class="text-gray-400 text-xs mb-1">平台股东</p>
                                    <p class="text-base font-pixel text-white">3,140 <span class="text-pi-yellow" style="font-weight: bold; font-size: 20px;">名</span></p>
                                </div>
                                <div class="bg-pi-yellow bg-opacity-20 p-1.5 rounded-lg border border-pi-yellow cursor-pointer hover:bg-pi-yellow hover:bg-opacity-30 transition-all duration-200 transform hover:scale-105" id="promotionShareholdersBtn">
                                    <p class="text-gray-400 text-xs mb-1">推广股东</p>
                                    <p class="text-base font-pixel text-white">3,140 <span class="text-pi-yellow" style="font-weight: bold; font-size: 20px;">名</span></p>
                                </div>
                                <div class="h-px w-full col-span-2"></div>
                                <div class="bg-gray-800 p-1.5 rounded-lg cursor-pointer hover:bg-gray-700 transition-all duration-200 transform hover:scale-105" id="myTerritoryBtn">
                                    <p class="text-gray-400 text-xs mb-1">我的领地</p>
                                    <p class="text-base font-pixel text-success">35.55 <span class="text-pi-yellow">方格</span></p>
                                </div>
                                <div class="bg-gray-800 p-1.5 rounded-lg cursor-pointer hover:bg-gray-700 transition-all duration-200 transform hover:scale-105" id="listedTerritoryBtn">
                                    <p class="text-gray-400 text-xs mb-1">上架/预购</p>
                                    <p class="text-base font-pixel text-success">42.33 <span class="text-pi-yellow">方格</span></p>
                                </div>
                                <div class="bg-gray-800 p-1.5 rounded-lg cursor-pointer hover:bg-gray-700 transition-all duration-200 transform hover:scale-105" id="territoryIncomeBtn">
                                    <p class="text-gray-400 text-xs mb-1">领地收益</p>
                                    <p class="text-base font-pixel text-success">11.00 <span class="text-pi-yellow">PI</span></p>
                                </div>
                                <div class="bg-gray-800 p-1.5 rounded-lg cursor-pointer hover:bg-gray-700 transition-all duration-200 transform hover:scale-105" id="shareholderIncomeBtn">
                                    <p class="text-gray-400 text-xs mb-1">股东收益</p>
                                    <p class="text-base font-pixel text-success">5.55 <span class="text-pi-yellow">PI</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 生态关联按钮区域 -->
                    <div class="mt-3">
                        <h3 class="text-xl font-pixel text-pi-yellow mb-2 text-center">关联其他pi生态</h3>
                        <div class="flex flex-col items-center">
                            <div class="flex justify-center gap-4 mb-1">
                                <button id="moonBoxBtn" class="w-10 h-10 bg-gray-900 border-2 border-pi-yellow rounded-lg flex items-center justify-center hover:bg-pi-yellow hover:text-black transition-colors duration-200 transform hover:scale-105">
                                    <i class="fa fa-moon-o"></i>
                                </button>
                                <button id="piGameBtn" class="w-10 h-10 bg-gray-900 border-2 border-pi-yellow rounded-lg flex items-center justify-center hover:bg-pi-yellow hover:text-black transition-colors duration-200 transform hover:scale-105">
                                    <i class="fa fa-gamepad"></i>
                                </button>
                                <button id="piVoiceBtn" class="w-10 h-10 bg-gray-900 border-2 border-pi-yellow rounded-lg flex items-center justify-center hover:bg-pi-yellow hover:text-black transition-colors duration-200 transform hover:scale-105">
                                    <i class="fa fa-volume-up"></i>
                                </button>
                                <button id="aboutUsBtn" class="w-10 h-10 bg-gray-900 border-2 border-pi-yellow rounded-lg flex items-center justify-center hover:bg-pi-yellow hover:text-black transition-colors duration-200 transform hover:scale-105">
                                    <i class="fa fa-info-circle"></i>
                                </button>
                            </div>
                            <div class="flex justify-center gap-6 text-xs text-gray-400">
                                <span>月光宝盒</span>
                                <span>派信娱乐</span>
                                <span>派之声</span>
                                <span>关于我们</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 全国派友社区模态框 -->
        <div id="communityModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden backdrop-blur-sm">
            <div class="bg-black rounded-lg p-4 border border-gray-800 max-w-2xl w-full max-h-[70vh] overflow-y-auto transform transition-all duration-300 scale-95 opacity-0" id="communityModalContent" style="box-shadow: 0 0 30px rgba(255, 193, 7, 0.3), inset 0 1px 0 0 rgba(255, 255, 255, 0.1);">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-base font-pixel text-pi-yellow">全国派友社区</h3>
                    <button class="close-modal-btn w-8 h-8 flex items-center justify-center rounded-full bg-gray-800 text-gray-300 hover:bg-pi-yellow hover:text-black transition-all duration-300 transform hover:scale-110">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                
                <!-- 社区列表 -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <!-- 北京社区 -->
                    <div class="bg-gray-900 rounded-lg p-3 border border-gray-700">
                        <h4 class="text-sm font-pixel text-pi-yellow mb-1">北京派友社区</h4>
                        <p class="text-gray-300 text-xs mb-1">📍 位置：北京市朝阳区</p>
                        <p class="text-gray-300 text-xs mb-1">📞 联系方式：010-12345678</p>
                        <p class="text-gray-300 text-xs">👥 成员数量：1,234</p>
                    </div>
                    
                    <!-- 上海社区 -->
                    <div class="bg-gray-900 rounded-lg p-3 border border-gray-700">
                        <h4 class="text-sm font-pixel text-pi-yellow mb-1">上海派友社区</h4>
                        <p class="text-gray-300 text-xs mb-1">📍 位置：上海市浦东新区</p>
                        <p class="text-gray-300 text-xs mb-1">📞 联系方式：021-87654321</p>
                        <p class="text-gray-300 text-xs">👥 成员数量：1,567</p>
                    </div>
                    
                    <!-- 广州社区 -->
                    <div class="bg-gray-900 rounded-lg p-3 border border-gray-700">
                        <h4 class="text-sm font-pixel text-pi-yellow mb-1">广州派友社区</h4>
                        <p class="text-gray-300 text-xs mb-1">📍 位置：广州市天河区</p>
                        <p class="text-gray-300 text-xs mb-1">📞 联系方式：020-13579246</p>
                        <p class="text-gray-300 text-xs">👥 成员数量：987</p>
                    </div>
                    
                    <!-- 深圳社区 -->
                    <div class="bg-gray-900 rounded-lg p-3 border border-gray-700">
                        <h4 class="text-sm font-pixel text-pi-yellow mb-1">深圳派友社区</h4>
                        <p class="text-gray-300 text-xs mb-1">📍 位置：深圳市南山区</p>
                        <p class="text-gray-300 text-xs mb-1">📞 联系方式：0755-24681357</p>
                        <p class="text-gray-300 text-xs">👥 成员数量：1,890</p>
                    </div>
                    
                    <!-- 杭州社区 -->
                    <div class="bg-gray-900 rounded-lg p-3 border border-gray-700">
                        <h4 class="text-sm font-pixel text-pi-yellow mb-1">杭州派友社区</h4>
                        <p class="text-gray-300 text-xs mb-1">📍 位置：杭州市西湖区</p>
                        <p class="text-gray-300 text-xs mb-1">📞 联系方式：0571-97531246</p>
                        <p class="text-gray-300 text-xs">👥 成员数量：876</p>
                    </div>
                    
                    <!-- 成都社区 -->
                    <div class="bg-gray-900 rounded-lg p-3 border border-gray-700">
                        <h4 class="text-sm font-pixel text-pi-yellow mb-1">成都派友社区</h4>
                        <p class="text-gray-300 text-xs mb-1">📍 位置：成都市锦江区</p>
                        <p class="text-gray-300 text-xs mb-1">📞 联系方式：028-86429753</p>
                        <p class="text-gray-300 text-xs">👥 成员数量：1,123</p>
                    </div>
                </div>
                
                <div class="flex justify-center gap-3 mt-4">
                    <button class="close-modal-btn px-4 py-1.5 bg-gradient-to-r from-pi-yellow to-yellow-400 text-black rounded-lg hover:from-yellow-400 hover:to-pi-yellow transition-all duration-300 text-sm font-medium transform hover:scale-105 active:scale-95 shadow-lg">关闭</button>
                </div>
            </div>
        </div>

        <!-- 今日数据流量模态框 -->
        <div id="dataFlowModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden backdrop-blur-sm">
            <div class="bg-black rounded-lg p-4 border border-gray-800 max-w-md w-full transform transition-all duration-300 scale-95 opacity-0" id="dataFlowModalContent" style="box-shadow: 0 0 30px rgba(255, 193, 7, 0.3), inset 0 1px 0 0 rgba(255, 255, 255, 0.1);">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-base font-pixel text-pi-yellow" id="dataFlowTitle">昨日数据流量</h3>
                    <button class="close-modal-btn w-8 h-8 flex items-center justify-center rounded-full bg-gray-800 text-gray-300 hover:bg-pi-yellow hover:text-black transition-all duration-300 transform hover:scale-110">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                
                <!-- 日期显示 -->
                <div class="text-center mb-4">
                    <p class="text-white text-lg font-pixel" id="dataFlowDate">2026年1月30日</p>
                </div>
                
                <!-- 数据统计 -->
                <div class="space-y-3">
                    <!-- 浏览量 -->
                    <div class="bg-gray-900 rounded-lg p-3">
                        <h4 class="text-sm font-pixel text-pi-yellow mb-2">浏览量</h4>
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-pixel text-white" id="dataFlowViews">12,345</span>
                            <span class="text-success font-pixel text-xs" id="dataFlowViewsGrowth">+15.6% <i class="fa fa-arrow-up"></i></span>
                        </div>
                        <p class="text-gray-400 text-xs mt-1">较前日增长</p>
                    </div>
                    
                    <!-- 操作方格人数 -->
                    <div class="bg-gray-900 rounded-lg p-3">
                        <h4 class="text-sm font-pixel text-pi-yellow mb-2">操作方格人数</h4>
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-pixel text-white" id="dataFlowUsers">2,345</span>
                            <span class="text-success font-pixel text-xs" id="dataFlowUsersGrowth">+8.3% <i class="fa fa-arrow-up"></i></span>
                        </div>
                        <p class="text-gray-400 text-xs mt-1">较前日增长</p>
                    </div>
                    
                    <!-- 广告商数量 -->
                    <div class="bg-gray-900 rounded-lg p-3">
                        <h4 class="text-sm font-pixel text-pi-yellow mb-2">广告商数量</h4>
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-pixel text-white" id="dataFlowAdvertisers">189</span>
                            <span class="text-success font-pixel text-xs" id="dataFlowAdsGrowth">+3.2% <i class="fa fa-arrow-up"></i></span>
                        </div>
                        <p class="text-gray-400 text-xs mt-1">较前日增长</p>
                    </div>
                </div>
                
                <!-- 导航按钮 -->
                <div class="flex justify-between mt-4">
                    <button id="prevDayBtn" class="w-10 h-10 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition-colors duration-200 flex items-center justify-center">
                        <i class="fa fa-arrow-left text-lg"></i>
                    </button>
                    <button id="nextDayBtn" class="w-10 h-10 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition-colors duration-200 flex items-center justify-center">
                        <i class="fa fa-arrow-right text-lg"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Web3广告模态框 -->
        <div id="web3AdModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden backdrop-blur-sm">
            <div class="bg-black rounded-lg p-4 border border-gray-800 max-w-md w-full transform transition-all duration-300 scale-95 opacity-0" id="web3AdModalContent" style="box-shadow: 0 0 30px rgba(255, 193, 7, 0.3), inset 0 1px 0 0 rgba(255, 255, 255, 0.1);">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-base font-pixel text-pi-yellow">Web3广告</h3>
                    <button class="close-modal-btn w-8 h-8 flex items-center justify-center rounded-full bg-gray-800 text-gray-300 hover:bg-pi-yellow hover:text-black transition-all duration-300 transform hover:scale-110">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                
                <!-- 广告统计 -->
                <div class="space-y-4">
                    <!-- 商家数量 -->
                    <div class="bg-gray-900 rounded-lg p-3">
                        <h4 class="text-sm font-pixel text-pi-yellow mb-2">商家数量</h4>
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-pixel text-white">156</span>
                            <span class="text-success font-pixel text-xs">+5.2% <i class="fa fa-arrow-up"></i></span>
                        </div>
                        <p class="text-gray-400 text-xs mt-1">较上周增长</p>
                    </div>
                    
                    <!-- 对接广告数量 -->
                    <div class="bg-gray-900 rounded-lg p-3">
                        <h4 class="text-sm font-pixel text-pi-yellow mb-2">对接广告数量</h4>
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-pixel text-white">234</span>
                            <span class="text-success font-pixel text-xs">+18.7% <i class="fa fa-arrow-up"></i></span>
                        </div>
                        <p class="text-gray-400 text-xs mt-1">较上周增长</p>
                    </div>
                    
                    <!-- 广告任务完成进度 -->
                    <div class="bg-gray-900 rounded-lg p-3">
                        <h4 class="text-sm font-pixel text-pi-yellow mb-2">广告任务完成进度</h4>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-xl font-pixel text-white"><span id="completedAds">15</span>/30 条</span>
                            <span class="text-pi-yellow font-pixel text-xs"><span id="progressPercentage">50</span>%</span>
                        </div>
                        <div class="w-full bg-gray-800 rounded-full h-2.5 mb-3">
                            <div id="progressBar" class="bg-pi-yellow h-2.5 rounded-full" style="width: 50%"></div>
                        </div>
                        <button id="watchAdBtn" class="w-full py-2 bg-blue-600 text-white font-pixel rounded-lg hover:bg-blue-500 transition-colors duration-300 flex items-center justify-center gap-2">
                            <i class="fa fa-play-circle"></i>
                            <span>观看广告</span>
                        </button>
                    </div>
                    
                    <!-- 广告收益 -->
                    <div class="bg-gray-900 rounded-lg p-3">
                        <h4 class="text-sm font-pixel text-pi-yellow mb-2">广告收益</h4>
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-pixel text-white">1,234.56 PI</span>
                            <span class="text-success font-pixel text-xs">+23.4% <i class="fa fa-arrow-up"></i></span>
                        </div>
                        <p class="text-gray-400 text-xs mt-1">较上周增长</p>
                    </div>
                </div>
                
                <div class="flex justify-center gap-3 mt-4">
                    <button class="close-modal-btn px-4 py-1.5 bg-gradient-to-r from-pi-yellow to-yellow-400 text-black rounded-lg hover:from-yellow-400 hover:to-pi-yellow transition-all duration-300 text-sm font-medium transform hover:scale-105 active:scale-95 shadow-lg">关闭</button>
                </div>
            </div>
        </div>

        <!-- 充值模态框 -->
        <div id="rechargeModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden backdrop-blur-sm">
            <div class="bg-black rounded-lg p-6 border border-gray-800 max-w-md w-full transform transition-all duration-300 scale-95 opacity-0" id="rechargeModalContent" style="box-shadow: 0 0 30px rgba(255, 193, 7, 0.3), inset 0 1px 0 0 rgba(255, 255, 255, 0.1);">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-pixel text-pi-yellow">派币充值</h3>
                    <button class="close-modal-btn w-8 h-8 flex items-center justify-center rounded-full bg-gray-800 text-gray-300 hover:bg-pi-yellow hover:text-black transition-all duration-300 transform hover:scale-110">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <!-- 充值地址 -->
                    <div>
                        <label class="block text-gray-400 text-sm mb-2">充值地址</label>
                        <div class="relative">
                            <input type="text" value="pi123456789abcdefghijklmnopqrstuvwxyz" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white font-mono text-sm" readonly="" id="rechargeAddress">
                            <button id="copyAddressBtn" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-pi-yellow hover:text-yellow-400 transition-colors">
                                <i class="fa fa-copy"></i>
                            </button>
                        </div>
                        <p class="text-gray-500 text-xs mt-1">请将派币转入以上地址，到账时间约5-10分钟</p>
                    </div>
                    
                    <!-- 充值金额 -->
                    <div>
                        <label class="block text-gray-400 text-sm mb-2">充值金额</label>
                        <div class="relative">
                            <input type="number" placeholder="请输入充值金额" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white" id="rechargeAmount" min="0.01" step="0.01">
                            <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400">PI</span>
                        </div>
                    </div>
                    
                    <!-- 支付方式 -->
                    <div>
                        <label class="block text-gray-400 text-sm mb-2">支付方式</label>
                        <select class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white">
                            <option value="pi">Pi Network</option>
                            <option value="other">其他方式</option>
                        </select>
                    </div>
                </div>
                
                <div class="flex justify-center gap-3 mt-6">
                    <button class="close-modal-btn px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors">取消</button>
                    <button id="confirmRechargeBtn" class="px-4 py-2 bg-gradient-to-r from-pi-yellow to-yellow-400 text-black rounded-lg hover:from-yellow-400 hover:to-pi-yellow transition-all duration-300 font-medium transform hover:scale-105 active:scale-95 shadow-lg">确认充值</button>
                </div>
            </div>
        </div>

        <!-- 提现模态框 -->
        <div id="withdrawModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden backdrop-blur-sm">
            <div class="bg-black rounded-lg p-6 border border-gray-800 max-w-md w-full transform transition-all duration-300 scale-95 opacity-0" id="withdrawModalContent" style="box-shadow: 0 0 30px rgba(255, 193, 7, 0.3), inset 0 1px 0 0 rgba(255, 255, 255, 0.1);">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-pixel text-pi-yellow">派币提现</h3>
                    <button class="close-modal-btn w-8 h-8 flex items-center justify-center rounded-full bg-gray-800 text-gray-300 hover:bg-pi-yellow hover:text-black transition-all duration-300 transform hover:scale-110">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <!-- 可用余额 -->
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">可用余额</label>
                        <p class="text-xl font-pixel text-white">1,234.56 PI</p>
                    </div>
                    
                    <!-- 提现地址 -->
                    <div>
                        <label class="block text-gray-400 text-sm mb-2">提现地址</label>
                        <input type="text" placeholder="请输入您的Pi收款地址" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white font-mono text-sm" id="withdrawAddress">
                        <p class="text-gray-500 text-xs mt-1">请确保地址正确，提现后无法撤回</p>
                    </div>
                    
                    <!-- 提现金额 -->
                    <div>
                        <label class="block text-gray-400 text-sm mb-2">提现金额</label>
                        <div class="relative">
                            <input type="number" placeholder="请输入提现金额" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white" id="withdrawAmount" min="0.01" step="0.01">
                            <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400">PI</span>
                        </div>
                        <div class="flex justify-end gap-2 mt-1">
                            <button id="withdrawAllBtn" class="text-xs text-pi-yellow hover:text-yellow-400 transition-colors">全部提现</button>
                            <button id="withdrawHalfBtn" class="text-xs text-pi-yellow hover:text-yellow-400 transition-colors">一半</button>
                        </div>
                    </div>
                    
                    <!-- 手续费 -->
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">手续费</label>
                        <p class="text-white">0.01 PI</p>
                    </div>
                </div>
                
                <div class="flex justify-center gap-3 mt-6">
                    <button class="close-modal-btn px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors">取消</button>
                    <button id="confirmWithdrawBtn" class="px-4 py-2 bg-gradient-to-r from-pi-yellow to-yellow-400 text-black rounded-lg hover:from-yellow-400 hover:to-pi-yellow transition-all duration-300 font-medium transform hover:scale-105 active:scale-95 shadow-lg">确认提现</button>
                </div>
            </div>
        </div>

        <!-- 信息模态框 -->
        <div id="infoModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden backdrop-blur-sm">
            <div class="bg-black rounded-lg p-6 border border-gray-800 max-w-md w-full transform transition-all duration-300 scale-95 opacity-0" id="infoModalContent" style="box-shadow: 0 0 30px rgba(255, 193, 7, 0.3), inset 0 1px 0 0 rgba(255, 255, 255, 0.1);">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-pixel text-pi-yellow" id="infoModalTitle">信息详情</h3>
                    <button class="close-modal-btn w-8 h-8 flex items-center justify-center rounded-full bg-gray-800 text-gray-300 hover:bg-pi-yellow hover:text-black transition-all duration-300 transform hover:scale-110">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-4" id="infoModalBody">
                    <!-- 内容将通过JavaScript动态填充 -->
                </div>
                
                <div class="flex justify-center mt-6">
                    <button class="close-modal-btn px-6 py-2 bg-gradient-to-r from-pi-yellow to-yellow-400 text-black rounded-lg hover:from-yellow-400 hover:to-pi-yellow transition-all duration-300 font-medium transform hover:scale-105 active:scale-95 shadow-lg">关闭</button>
                </div>
            </div>
        </div>

        <!-- 关于我们模态框 -->
        <div id="aboutUsModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden backdrop-blur-sm">
            <div class="bg-black rounded-lg p-6 border border-gray-800 max-w-md w-full transform transition-all duration-300 scale-95 opacity-0" id="aboutUsModalContent" style="box-shadow: 0 0 30px rgba(255, 193, 7, 0.3), inset 0 1px 0 0 rgba(255, 255, 255, 0.1);">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-pixel text-pi-yellow">关于我们</h3>
                    <button class="close-modal-btn w-8 h-8 flex items-center justify-center rounded-full bg-gray-800 text-gray-300 hover:bg-pi-yellow hover:text-black transition-all duration-300 transform hover:scale-110">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-4 text-white">
                    <p>Pi像素领地是一个基于Pi Network的创新数字艺术平台，致力于为全球派友提供一个创作、分享和交易数字艺术作品的生态系统。</p>
                    
                    <div class="bg-gray-900 p-4 rounded-lg">
                        <h4 class="text-pi-yellow font-bold mb-2">联系方式</h4>
                        <p class="mb-2"><i class="fa fa-twitter mr-2 text-pi-yellow"></i> Twitter: @PiPixelMap</p>
                        <p class="mb-2"><i class="fa fa-telegram mr-2 text-pi-yellow"></i> Telegram: t.me/PiPixelMap</p>
                        <p><i class="fa fa-envelope mr-2 text-pi-yellow"></i> Email: contact@pipixelmap.com</p>
                    </div>
                    
                    <p class="text-gray-400 text-sm">我们致力于打造一个公平、透明、创新的Pi生态应用，欢迎各位派友加入我们的社区，共同建设美好的数字未来！</p>
                </div>
                
                <div class="flex justify-center mt-6">
                    <button class="close-modal-btn px-6 py-2 bg-gradient-to-r from-pi-yellow to-yellow-400 text-black rounded-lg hover:from-yellow-400 hover:to-pi-yellow transition-all duration-300 font-medium transform hover:scale-105 active:scale-95 shadow-lg">关闭</button>
                </div>
            </div>
        </div>

        <!-- 生态跳转确认模态框 -->
        <div id="ecosystemConfirmModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden backdrop-blur-sm">
            <div class="bg-black rounded-lg p-6 border border-gray-800 max-w-sm w-full transform transition-all duration-300 scale-95 opacity-0" id="ecosystemConfirmModalContent" style="box-shadow: 0 0 30px rgba(255, 193, 7, 0.3), inset 0 1px 0 0 rgba(255, 255, 255, 0.1);">
                <div class="text-center">
                    <h3 class="text-xl font-pixel text-pi-yellow mb-4">确认跳转</h3>
                    <p class="text-white mb-6" id="ecosystemConfirmText">是否前往此生态？</p>
                    
                    <div class="flex justify-center gap-4">
                        <button id="cancelEcosystemBtn" class="px-6 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors">取消</button>
                        <button id="confirmEcosystemBtn" class="px-6 py-2 bg-gradient-to-r from-pi-yellow to-yellow-400 text-black rounded-lg hover:from-yellow-400 hover:to-pi-yellow transition-all duration-300 font-medium transform hover:scale-105 active:scale-95 shadow-lg">确定</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 方格详情模态框 -->
        <div id="squareDetailModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden backdrop-blur-sm">
            <div class="bg-black rounded-lg p-6 border border-gray-800 max-w-md w-full transform transition-all duration-300 scale-95 opacity-0" id="squareDetailModalContent" style="box-shadow: 0 0 30px rgba(255, 193, 7, 0.3), inset 0 1px 0 0 rgba(255, 255, 255, 0.1);">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-pixel text-pi-yellow" id="squareDetailTitle">方格详情</h3>
                    <button class="close-modal-btn w-8 h-8 flex items-center justify-center rounded-full bg-gray-800 text-gray-300 hover:bg-pi-yellow hover:text-black transition-all duration-300 transform hover:scale-110">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-4" id="squareDetailBody">
                    <!-- 内容将通过JavaScript动态填充 -->
                </div>
                
                <div class="flex justify-center mt-6">
                    <button class="close-modal-btn px-6 py-2 bg-gradient-to-r from-pi-yellow to-yellow-400 text-black rounded-lg hover:from-yellow-400 hover:to-pi-yellow transition-all duration-300 font-medium transform hover:scale-105 active:scale-95 shadow-lg">关闭</button>
                </div>
            </div>
        </div>
    </main>

    <!-- 导航按钮 -->
    <div class="mt-4 flex justify-center gap-3 flex-wrap max-w-md mx-auto">
        <button id="homeBtn" class="px-2 py-1.5 bg-pi-yellow text-black rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105 active:scale-95 flex items-center gap-1 text-sm justify-center whitespace-nowrap w-20">
            <i class="fa fa-home"></i>
            <span style="font-weight: bold;">首页</span>
        </button>
        <button id="achievementsBtn" class="px-2 py-1.5 bg-pi-yellow text-black rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105 active:scale-95 flex items-center gap-1 text-sm justify-center whitespace-nowrap w-24">
            <i class="fa fa-trophy"></i>
            <span style="font-weight: bold;">全民收益</span>
        </button>
        <button id="profileBtn" class="px-2 py-1.5 bg-pi-yellow text-black rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105 active:scale-95 flex items-center gap-1 text-sm justify-center whitespace-nowrap w-20">
            <i class="fa fa-user"></i>
            <span style="font-weight: bold;">我的</span>
        </button>
    </div>

    <!-- 登录模态框 -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-900 rounded-lg p-6 max-w-md w-full">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-pixel text-pi-yellow">PI账号登录</h2>
                <button id="closeLoginModalBtn" class="text-gray-400 hover:text-white text-2xl">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            
            <div class="mb-4">
                <p class="text-gray-300 mb-3">请选择登录方式：</p>
                
                <div class="space-y-3">
                    <!-- PI账号授权选项 -->
                    <div class="border border-pi-yellow rounded-lg p-3 cursor-pointer hover:bg-gray-800 transition-colors" id="piAuthOption">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-pi-yellow rounded-full flex items-center justify-center">
                                <i class="fa fa-pi text-black text-xl"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-white">PI账号授权</h3>
                                <p class="text-sm text-gray-400">使用您的PI Network账号登录</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 用户名输入区域（初始隐藏） -->
            <div id="usernameInputArea" class="mb-4 hidden">
                <label for="piUsername" class="block text-gray-300 mb-2">PI用户名</label>
                <input type="text" id="piUsername" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-pi-yellow" placeholder="请输入与邀请码一致的用户名">
                <p class="text-sm text-gray-500 mt-2">请确保用户名与您的PI Network邀请码完全一致</p>
            </div>
            
            <!-- 操作按钮 -->
            <div class="flex gap-3">
                <button id="cancelLoginBtn" class="flex-1 px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors">
                    取消
                </button>
                <button id="confirmLoginBtn" class="flex-1 px-4 py-2 bg-pi-yellow text-black rounded-lg hover:bg-yellow-400 transition-colors hidden opacity-50 cursor-not-allowed" disabled="">
                    确认授权
                </button>
            </div>
        </div>
    </div>

    <!-- 页脚 -->
    <footer class="bg-black border-t border-gray-800 py-4 px-6 mt-6">
        <div class="container mx-auto">
            <div class="text-center text-gray-500 text-sm">
                <p>Pi像素格子游戏 © 20260126</p>
            </div>
        </div>
    </footer>

    <script>
        // 游戏配置
        const GAME_CONFIG = {
            gridSize: 200,
            cellSize: 3,
            centerRadius: 20,
            goldRadius: 60,
            silverRadius: 100,
            canvasId: 'pixelMap',
            toolbarId: 'toolbar',
            statusBarId: 'statusBar'
        };

        // 生成模拟的每日数据流量
        const generateDailyData = () => {
            const data = [];
            const today = new Date();
            
            // 生成过去30天的数据
            for (let i = 29; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                
                // 基础值
                const baseViews = 10000 + Math.floor(Math.random() * 5000);
                const baseUsers = 2000 + Math.floor(Math.random() * 1000);
                const baseAds = 150 + Math.floor(Math.random() * 100);
                
                // 添加一些趋势和波动
                const trendFactor = 1 + (i / 100); // 轻微上升趋势
                const randomFactor = 0.9 + Math.random() * 0.2; // 10% 随机波动
                
                data.push({
                    date: date,
                    dateStr: `${date.getFullYear()}年${date.getMonth() + 1}月${date.getDate()}日`,
                    views: Math.floor(baseViews * trendFactor * randomFactor),
                    users: Math.floor(baseUsers * trendFactor * randomFactor),
                    advertisers: Math.floor(baseAds * trendFactor * randomFactor),
                    growth: (Math.random() * 20 - 5).toFixed(1) // -5% 到 +15% 的增长率
                });
            }
            
            return data;
        };

        // 排行榜数据
        const rankingData = [
            { rank: 1, name: "中心广场", coords: "(90, 90)", pi: 100, views: 12345 },
            { rank: 2, name: "财富大街", coords: "(91, 90)", pi: 88, views: 9876 },
            { rank: 3, name: "艺术区", coords: "(90, 91)", pi: 77, views: 8765 },
            { rank: 4, name: "科技谷", coords: "(91, 91)", pi: 66, views: 7654 },
            { rank: 5, name: "创意园", coords: "(89, 90)", pi: 55, views: 6543 },
            { rank: 6, name: "梦想城", coords: "(90, 89)", pi: 44, views: 5432 },
            { rank: 7, name: "未来港", coords: "(92, 90)", pi: 33, views: 4321 },
            { rank: 8, name: "智慧园", coords: "(90, 92)", pi: 22, views: 3210 },
            { rank: 9, name: "和谐里", coords: "(89, 89)", pi: 11, views: 2109 },
            { rank: 10, name: "星光道", coords: "(89, 91)", pi: 10, views: 1098 },
            { rank: 11, name: "金融区", coords: "(92, 91)", pi: 9, views: 987 },
            { rank: 12, name: "教育园", coords: "(91, 92)", pi: 8, views: 876 },
            { rank: 13, name: "医疗中心", coords: "(88, 90)", pi: 7, views: 765 },
            { rank: 14, name: "体育场馆", coords: "(90, 88)", pi: 6, views: 654 },
            { rank: 15, name: "文化街", coords: "(93, 90)", pi: 5, views: 543 },
            { rank: 16, name: "科技园", coords: "(89, 92)", pi: 4, views: 432 },
            { rank: 17, name: "生态园", coords: "(91, 88)", pi: 3, views: 321 },
            { rank: 18, name: "旅游区", coords: "(87, 90)", pi: 2, views: 210 },
            { rank: 19, name: "商业区", coords: "(90, 87)", pi: 1.5, views: 198 },
            { rank: 20, name: "住宅区", coords: "(94, 90)", pi: 1.2, views: 187 },
            { rank: 21, name: "工业区", coords: "(88, 89)", pi: 1.1, views: 176 },
            { rank: 22, name: "农业区", coords: "(89, 88)", pi: 1.0, views: 165 },
            { rank: 23, name: "港口区", coords: "(92, 89)", pi: 0.9, views: 154 },
            { rank: 24, name: "机场", coords: "(86, 90)", pi: 0.8, views: 143 },
            { rank: 25, name: "车站", coords: "(90, 86)", pi: 0.7, views: 132 },
            { rank: 26, name: "物流中心", coords: "(95, 90)", pi: 0.6, views: 121 },
            { rank: 27, name: "仓库区", coords: "(87, 89)", pi: 0.5, views: 110 },
            { rank: 28, name: "停车场", coords: "(89, 87)", pi: 0.4, views: 99 },
            { rank: 29, name: "加油站", coords: "(91, 87)", pi: 0.3, views: 88 },
            { rank: 30, name: "休息区", coords: "(85, 90)", pi: 0.2, views: 77 }
        ];

        let currentPage = 0;
        const itemsPerPage = 10;

        // 更新排行榜显示
        const updateRankingDisplay = () => {
            const startIndex = currentPage * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageData = rankingData.slice(startIndex, endIndex);
            
            const rankingList = document.querySelector('#rankingModal .space-y-1.mt-2');
            rankingList.innerHTML = '';
            
            pageData.forEach((item, index) => {
                const isLast = index === pageData.length - 1;
                const row = document.createElement('div');
                row.className = `grid grid-cols-4 gap-1 text-center items-center ${isLast ? '' : 'border-b border-gray-700 pb-1'}`;
                
                row.innerHTML = `
                    <div class="text-white font-pixel text-xs">${item.rank}</div>
                    <div class="text-white font-pixel text-xs text-center">${item.coords.replace('(', '').replace(')', '')}</div>
                    <div class="text-success font-pixel text-xs text-center">${item.pi} PI</div>
                    <div class="text-pi-yellow font-pixel text-xs text-center">${item.views.toLocaleString()}</div>
                `;
                
                rankingList.appendChild(row);
            });
            
            // 更新按钮状态
            document.getElementById('prevRankingBtn').disabled = currentPage === 0;
            document.getElementById('prevRankingBtn').classList.toggle('opacity-50', currentPage === 0);
            document.getElementById('nextRankingBtn').disabled = endIndex >= rankingData.length;
            document.getElementById('nextRankingBtn').classList.toggle('opacity-50', endIndex >= rankingData.length);
            
            // 更新页码信息
            document.getElementById('rankingPageInfo').textContent = `${startIndex + 1}-${Math.min(endIndex, rankingData.length)} / ${rankingData.length}`;
        };

        // 切换排行榜页码
        function changeRankingPage(direction) {
            const maxPage = Math.ceil(rankingData.length / itemsPerPage) - 1;
            currentPage = Math.max(0, Math.min(maxPage, currentPage + direction));
            updateRankingDisplay();
        }

        // 更新数据流量显示
        const updateDataFlowDisplay = () => {
            const data = dailyData[currentDataIndex];
            const today = new Date();
            const isToday = data.date.toDateString() === today.toDateString();
            const isYesterday = new Date(today);
            isYesterday.setDate(isYesterday.getDate() - 1);
            const isYesterdayData = data.date.toDateString() === isYesterday.toDateString();
            
            // 更新标题
            if (isToday) {
                document.getElementById('dataFlowTitle').textContent = '今日数据流量';
            } else if (isYesterdayData) {
                document.getElementById('dataFlowTitle').textContent = '昨日数据流量';
            } else {
                document.getElementById('dataFlowTitle').textContent = '历史数据流量';
            }
            
            // 更新日期
            document.getElementById('dataFlowDate').textContent = data.dateStr;
            
            // 更新数据
            document.getElementById('dataFlowViews').textContent = data.views.toLocaleString();
            document.getElementById('dataFlowUsers').textContent = data.users.toLocaleString();
            document.getElementById('dataFlowAdvertisers').textContent = data.advertisers.toLocaleString();
            
            // 更新增长率
            const viewsGrowth = document.getElementById('dataFlowViewsGrowth');
            const usersGrowth = document.getElementById('dataFlowUsersGrowth');
            const adsGrowth = document.getElementById('dataFlowAdsGrowth');
            
            const updateGrowthElement = (element, growth) => {
                const isPositive = parseFloat(growth) >= 0;
                element.textContent = `${isPositive ? '+' : ''}${growth}% ${isPositive ? '↑' : '↓'}`;
                element.className = `font-pixel text-xs ${isPositive ? 'text-success' : 'text-danger'}`;
            };
            
            updateGrowthElement(viewsGrowth, data.growth);
            updateGrowthElement(usersGrowth, data.growth);
            updateGrowthElement(adsGrowth, data.growth);
            
            // 更新按钮状态
            document.getElementById('prevDayBtn').disabled = currentDataIndex === 0;
            document.getElementById('prevDayBtn').classList.toggle('opacity-50', currentDataIndex === 0);
            document.getElementById('nextDayBtn').disabled = currentDataIndex === dailyData.length - 1;
            document.getElementById('nextDayBtn').classList.toggle('opacity-50', currentDataIndex === dailyData.length - 1);
        };

        // 广告任务状态
        let adTaskState = {
            totalAds: 30,
            completedAds: 15
        };

        // 模态框配置
        const MODAL_CONFIG = {
            universalSquares: {
                title: '万能方格详情',
                content: `
                    <div class="bg-gray-900 p-4 rounded-lg">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-white">总数量：</span>
                            <span class="text-pi-yellow font-bold text-lg">42 个</span>
                        </div>
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-white">可用数量：</span>
                            <span class="text-pi-yellow font-bold text-lg">35 个</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white">已使用数量：</span>
                            <span class="text-pi-yellow font-bold text-lg">7 个</span>
                        </div>
                    </div>
                    <p class="text-white mt-4">万能方格说明：</p>
                    <ul class="list-disc list-inside space-y-2 text-gray-300">
                        <li>可以在地图上任意位置使用</li>
                        <li>不受区域限制</li>
                        <li>具有更高的收藏价值</li>
                        <li>可用于兑换稀有道具</li>
                    </ul>
                `
            },
            coordinateSquares: {
                title: '坐标方格详情',
                content: `
                    <div class="bg-gray-900 p-4 rounded-lg mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-white">总数量：</span>
                            <span class="text-pi-yellow font-bold text-lg">18 个</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white">分布区域：</span>
                            <span class="text-pi-yellow font-bold text-lg">中心/黄金区域</span>
                        </div>
                    </div>
                    <p class="text-white mb-3">坐标分布详情：</p>
                    <div class="space-y-2">
                        <div class="bg-gray-900 p-3 rounded-lg">
                            <div class="flex justify-between items-center">
                                <span class="text-white">X轴 1-1 方格：</span>
                                <span class="text-pi-yellow font-bold">5 个</span>
                            </div>
                        </div>
                        <div class="bg-gray-900 p-3 rounded-lg">
                            <div class="flex justify-between items-center">
                                <span class="text-white">X轴 2-3 方格：</span>
                                <span class="text-pi-yellow font-bold">8 个</span>
                            </div>
                        </div>
                        <div class="bg-gray-900 p-3 rounded-lg">
                            <div class="flex justify-between items-center">
                                <span class="text-white">X轴 4-5 方格：</span>
                                <span class="text-pi-yellow font-bold">5 个</span>
                            </div>
                        </div>
                    </div>
                `
            },
            listedUniversalSquares: {
                title: '上架万能方格详情',
                content: `
                    <div class="bg-gray-900 p-4 rounded-lg">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-white">上架数量：</span>
                            <span class="text-pi-yellow font-bold text-lg">25 个</span>
                        </div>
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-white">平均售价：</span>
                            <span class="text-pi-yellow font-bold text-lg">8.5 PI/个</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white">总价值：</span>
                            <span class="text-pi-yellow font-bold text-lg">212.5 PI</span>
                        </div>
                    </div>
                    <p class="text-white mt-4">上架详情：</p>
                    <ul class="list-disc list-inside space-y-2 text-gray-300">
                        <li>立即出售：15 个 (7.0 PI/个)</li>
                        <li>竞拍中：10 个 (起拍价：10.0 PI/个)</li>
                    </ul>
                `
            },
            listedCoordinateSquares: {
                title: '上架坐标方格详情',
                content: `
                    <div class="bg-gray-900 p-4 rounded-lg mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-white">上架数量：</span>
                            <span class="text-pi-yellow font-bold text-lg">17 个</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white">总价值：</span>
                            <span class="text-pi-yellow font-bold text-lg">153.0 PI</span>
                        </div>
                    </div>
                    <p class="text-white mb-3">坐标分布详情：</p>
                    <div class="space-y-2">
                        <div class="bg-gray-900 p-3 rounded-lg">
                            <div class="flex justify-between items-center">
                                <span class="text-white">X轴 1-1 方格：</span>
                                <span class="text-pi-yellow font-bold">5 个 (10.0 PI/个)</span>
                            </div>
                        </div>
                        <div class="bg-gray-900 p-3 rounded-lg">
                            <div class="flex justify-between items-center">
                                <span class="text-white">X轴 2-3 方格：</span>
                                <span class="text-pi-yellow font-bold">12 个 (9.0 PI/个)</span>
                            </div>
                        </div>
                    </div>
                `
            }
        };

        // 全局变量
        const MAP_SIZE_X = 100; // 宽100个格子
        const MAP_SIZE_Y = 100; // 高100个格子
        const PIXEL_SIZE_CM = 1; // 每个像素1厘米
        const PIXEL_SIZE_PX = 15; // 1厘米 ≈ 15像素（屏幕显示比例）
        const CANVAS_WIDTH = MAP_SIZE_X * PIXEL_SIZE_PX; // Canvas宽度：100×20=2000px
        const CANVAS_HEIGHT = MAP_SIZE_Y * PIXEL_SIZE_PX; // Canvas高度：100×20=2000px
        
        let pixels = []; // 存储所有像素块的数据
        let selectedColor = '#FFFFFF'; // 默认选中的颜色
        let zoom = 0.3; // 初始缩放比例（适配3x3厘米显示）
        let panX = 0; // 平移X坐标
        let panY = 0; // 平移Y坐标
        let zoomInCount = 0; // 放大次数计数器
        let zoomOutCount = 0; // 缩小次数计数器
        const MAX_ZOOM_IN = 30; // 最大放大次数
        const MAX_ZOOM_OUT = 40; // 最大缩小次数
        let isDragging = false; // 是否正在拖动地图
        let lastMouseX = 0; // 上一次鼠标X坐标
        let lastMouseY = 0; // 上一次鼠标Y坐标
        let showGrid = true; // 是否显示网格
        let currentSelectedPixel = null; // 当前选中的像素块
        let isPixelDragging = false; // 是否正在拖动单个像素块
        let hoveredPixel = null; // 当前悬停的像素块
        const PIXEL_PRICE = 3.14; // 每个像素块的价格（派币）
        
        // 预定义颜色列表
        const predefinedColors = [
            '#FFFFFF', // 白色
            '#000000', // 黑色
            '#FF0000', // 赤(红)
            '#FF7F00', // 橙
            '#FFFF00', // 黄
            '#00FF00', // 绿
            '#00FFFF', // 青
            '#0000FF', // 蓝
            '#800080'  // 紫
        ];
        
        // 初始化函数
        function init() {
            // 初始化像素数据
            initializePixels();
            
            // 初始化Canvas
            const canvas = document.getElementById('pixelMap');
            canvas.width = CANVAS_WIDTH;
            canvas.height = CANVAS_HEIGHT;
            
            // 生成颜色选择器
            generateColorPalette();
            
            // 添加事件监听器
            addEventListeners();
            
            // 设置初始视图并立即渲染
            setInitialZoom();
            centerMap();
            renderMap();
            updateStats();
        }
        
        // 设置初始放大级别
        function setInitialZoom() {
            zoom = 0.2; // 初始缩放比例适配大尺寸地图
            zoomInCount = 0;
            zoomOutCount = 0;
            
            // 重置按钮状态
            const zoomInBtn = document.getElementById('zoomInBtn');
            const zoomOutBtn = document.getElementById('zoomOutBtn');
            zoomInBtn.disabled = false;
            zoomInBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            zoomOutBtn.disabled = false;
            zoomOutBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }
        
        // 居中地图
        function centerMap() {
            const canvas = document.getElementById('pixelMap');
            const container = canvas.parentElement;
            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;
            
            // 计算居中位置
            panX = (containerWidth - CANVAS_WIDTH * zoom) / 2;
            panY = (containerHeight - CANVAS_HEIGHT * zoom) / 2;
        }
        
        // 初始化像素数据
        function initializePixels() {
            pixels = [];
            
            // 创建100x100的像素网格
            for (let y = 0; y < MAP_SIZE_Y; y++) {
                for (let x = 0; x < MAP_SIZE_X; x++) {
                    // 检查是否在中心11x11区域（X45-Y45到X55-Y55）
                    const isInCenterArea = x >= 45 && x <= 55 && y >= 45 && y <= 55;
                    // 检查是否是中心区域的边框（最外层）
                    const isCenterBorder = isInCenterArea && (x === 45 || x === 55 || y === 45 || y === 55);
                    // 检查是否是内部10x10核心区域
                    const isInnerCore = isInCenterArea && !isCenterBorder;
                    
                    pixels.push({
                        id: `pixel_${x}_${y}`,
                        x,
                        y,
                        color: isCenterBorder ? '#000000' : '#FFFFFF', // 边框填充黑色
                        isOwned: isCenterBorder || isInnerCore, // 边框和内部核心区域默认已拥有
                        owner: isCenterBorder ? 'system' : (isInnerCore ? 'platform' : null), // 边框属于系统，内部属于平台
                        isOnSale: false, // 是否上架出售
                        note: isCenterBorder ? '这只是一个坚不可摧的黑色方框' : (isInnerCore ? '归此平台生态方所有' : null), // 备注信息
                        transactionHistory: isCenterBorder ? [{
                            type: '系统',
                            timestamp: new Date(),
                            description: '坚不可摧的黑色边框'
                        }] : (isInnerCore ? [{
                            type: '系统',
                            timestamp: new Date(),
                            description: '平台股东专属绘制区域'
                        }] : []), // 交易历史记录
                        isCenterArea: isInCenterArea, // 标记是否在中心区域
                        isCenterBorder: isCenterBorder, // 标记是否是边框
                        isPlatformOnly: isInnerCore, // 标记是否仅平台可编辑
                        isSystemProtected: isCenterBorder // 标记是否受系统保护不可修改
                    });
                }
            }
            
            // 添加一些示例数据，方便测试
            addSampleData();
        }
        
        // 添加示例数据
        function addSampleData() {
            // 随机选择一些像素块作为已购买的示例
            const samplePixels = [
                { x: 90, y: 90, color: '#FF0000', note: '中心像素块' },
                { x: 91, y: 90, color: '#00FF00', note: '示例像素块1' },
                { x: 90, y: 91, color: '#0000FF', isOnSale: true },
                { x: 91, y: 91, color: '#FFFF00' },
                { x: 89, y: 90, color: '#FF00FF' }
            ];
            
            samplePixels.forEach(sample => {
                const index = sample.y * MAP_SIZE_X + sample.x;
                if (index >= 0 && index < pixels.length) {
                    pixels[index].isOwned = true;
                    pixels[index].owner = 'sampleUser';
                    pixels[index].color = sample.color;
                    pixels[index].note = sample.note || null;
                    pixels[index].isOnSale = sample.isOnSale || false;
                    
                    // 添加交易历史记录
                    const now = new Date();
                    const oneDayAgo = new Date(now.getTime() - 24 * 60 * 60 * 1000);
                    const twoDaysAgo = new Date(now.getTime() - 2 * 24 * 60 * 60 * 1000);
                    
                    pixels[index].transactionHistory = [
                        {
                            type: '购买',
                            timestamp: twoDaysAgo,
                            description: '用户 sampleUser 购买了此像素块'
                        }
                    ];
                    
                    if (sample.isOnSale) {
                        pixels[index].transactionHistory.push({
                            type: '上架',
                            timestamp: oneDayAgo,
                            description: '用户 sampleUser 将此像素块上架出售'
                        });
                    }
                }
            });
        }
        
        // 生成颜色选择器
        function generateColorPalette() {
            const colorPalette = document.getElementById('colorPalette');
            
            // 清空现有颜色
            colorPalette.innerHTML = '';
            
            // 添加预定义颜色
            predefinedColors.forEach((color, index) => {
                const colorDiv = document.createElement('div');
                
                // 为白色方格添加特殊样式和文字
                if (color === '#FFFFFF') {
                    colorDiv.className = 'color-picker';
                } else {
                    colorDiv.className = 'color-picker';
                    // 为黑色方格添加细白边框
                    if (color === '#000000') {
                        colorDiv.classList.add('ring-1', 'ring-white');
                    }
                }
                
                colorDiv.style.backgroundColor = color;
                colorDiv.dataset.color = color;
                
                // 添加点击事件
                colorDiv.addEventListener('click', () => {
                    selectColor(color);
                });
                
                colorPalette.appendChild(colorDiv);
            });
            
            // 默认选中第一个颜色
            selectColor(predefinedColors[0]);
        }
        
        // 选择颜色
        function selectColor(color) {
            selectedColor = color;
            
            // 更新UI
            document.querySelectorAll('.color-picker').forEach(div => {
                div.classList.remove('ring-4', 'ring-white');
            });
            
            // 找到选中的颜色并添加高亮
            document.querySelectorAll('.color-picker').forEach(div => {
                if (div.dataset.color === color) {
                    div.classList.add('ring-4', 'ring-white');
                }
            });
        }
        
        // 添加事件监听器
        function addEventListeners() {
            const canvas = document.getElementById('pixelMap');
            const refreshBtn = document.getElementById('refreshBtn');
            const zoomInBtn = document.getElementById('zoomInBtn');
            const zoomOutBtn = document.getElementById('zoomOutBtn');

            const buyPixelBtn = document.getElementById('buyPixelBtn');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const loginBtn = document.getElementById('loginBtn');
            const closeLoginModalBtn = document.getElementById('closeLoginModalBtn');
            const cancelLoginBtn = document.getElementById('cancelLoginBtn');
            const piAuthOption = document.getElementById('piAuthOption');
            const confirmLoginBtn = document.getElementById('confirmLoginBtn');
            const piUsernameInput = document.getElementById('piUsername');
            
            // Canvas事件
            canvas.addEventListener('click', handleCanvasClick);
            canvas.addEventListener('mousedown', handleCanvasMouseDown);
            canvas.addEventListener('mousemove', handleCanvasMouseMove);
            canvas.addEventListener('mouseup', handleCanvasMouseUp);
            canvas.addEventListener('mouseleave', handleCanvasMouseUp);
            canvas.addEventListener('wheel', handleCanvasWheel);
            
            // 弹窗按钮事件
            buyPixelBtn.addEventListener('click', handleBuyPixel);
            closeModalBtn.addEventListener('click', closePixelInfoModal);
            
            // 登录相关事件会在showPage函数中动态添加
            closeLoginModalBtn.addEventListener('click', closeLoginModal);
            cancelLoginBtn.addEventListener('click', closeLoginModal);
            piAuthOption.addEventListener('click', handlePiAuthSelection);
            confirmLoginBtn.addEventListener('click', handlePiAuthConfirm);
            piUsernameInput.addEventListener('input', handleUsernameInput);
            
            // 导航按钮事件
            document.getElementById('homeBtn').addEventListener('click', handleHomeClick);
            document.getElementById('achievementsBtn').addEventListener('click', handleAchievementsClick);
            document.getElementById('profileBtn').addEventListener('click', handleProfileClick);
            
            // 刷新按钮事件
            refreshBtn.addEventListener('click', () => {
                // 重置地图状态
                setInitialZoom();
                centerMap();
                renderMap();
                updateStats();
                alert('地图已刷新！');
            });
            
            // 缩放和平移控制
            zoomInBtn.addEventListener('click', () => {
                if (zoomInCount < MAX_ZOOM_IN) {
                    // 每次点击放大1.1倍
                    zoom *= 1.1;
                    zoomInCount++;
                    zoomOutCount = 0; // 重置缩小次数
                    centerMap();
                    renderMap();
                    
                    // 更新按钮状态
                    if (zoomInCount >= MAX_ZOOM_IN) {
                        zoomInBtn.disabled = true;
                        zoomInBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    }
                    zoomOutBtn.disabled = false;
                    zoomOutBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            });
            
            zoomOutBtn.addEventListener('click', () => {
                if (zoomOutCount < MAX_ZOOM_OUT) {
                    // 每次点击缩小0.9倍
                    zoom *= 0.9;
                    zoomOutCount++;
                    zoomInCount = 0; // 重置放大次数
                    centerMap();
                    renderMap();
                    
                    // 更新按钮状态
                    if (zoomOutCount >= MAX_ZOOM_OUT) {
                        zoomOutBtn.disabled = true;
                        zoomOutBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    }
                    zoomInBtn.disabled = false;
                    zoomInBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            });
            
            // 窗口大小改变时重新居中
            window.addEventListener('resize', () => {
                centerMap();
                renderMap();
            });
            
            // 签到按钮事件会在showPage函数中动态添加
            
            // 添加触摸事件支持
            canvas.addEventListener('touchstart', handleCanvasTouchStart);
            canvas.addEventListener('touchmove', handleCanvasTouchMove);
            canvas.addEventListener('touchend', handleCanvasTouchEnd);

            // 全民收益页面按钮事件
            document.getElementById('rankingButton').addEventListener('click', function() {
                const modal = document.getElementById('rankingModal');
                const modalContent = document.getElementById('rankingModalContent');
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
                currentPage = 0; // 重置到第一页
                updateRankingDisplay();
            });

            document.getElementById('closeRankingModalBtn').addEventListener('click', function() {
                const modal = document.getElementById('rankingModal');
                const modalContent = document.getElementById('rankingModalContent');
                modalContent.classList.remove('scale-100', 'opacity-100');
                modalContent.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            });

            document.getElementById('closeRankingBtn').addEventListener('click', function() {
                const modal = document.getElementById('rankingModal');
                const modalContent = document.getElementById('rankingModalContent');
                modalContent.classList.remove('scale-100', 'opacity-100');
                modalContent.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            });

            document.getElementById('dataFlowButton').addEventListener('click', function() {
                const modal = document.getElementById('dataFlowModal');
                const modalContent = document.getElementById('dataFlowModalContent');
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
                updateDataFlowDisplay();
            });

            // 前一天按钮事件
            document.getElementById('prevDayBtn').addEventListener('click', function() {
                if (currentDataIndex > 0) {
                    currentDataIndex--;
                    updateDataFlowDisplay();
                }
            });

            // 后一天按钮事件
            document.getElementById('nextDayBtn').addEventListener('click', function() {
                if (currentDataIndex < dailyData.length - 1) {
                    currentDataIndex++;
                    updateDataFlowDisplay();
                }
            });

            document.getElementById('rankingButton2').addEventListener('click', function() {
                const modal = document.getElementById('rankingModal');
                const modalContent = document.getElementById('rankingModalContent');
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
                currentPage = 0; // 重置到第一页
                updateRankingDisplay();
            });

            document.getElementById('dataFlowButton').addEventListener('click', function() {
                const modal = document.getElementById('dataFlowModal');
                const modalContent = document.getElementById('dataFlowModalContent');
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            });

            document.getElementById('dataFlowButton2').addEventListener('click', function() {
                const modal = document.getElementById('web3AdModal');
                const modalContent = document.getElementById('web3AdModalContent');
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
                updateAdProgressUI();
            });

            // 观看广告按钮事件
            document.getElementById('watchAdBtn').addEventListener('click', function() {
                const watchBtn = this;
                const originalText = watchBtn.innerHTML;
                
                // 检查是否已完成所有广告
                if (adTaskState.completedAds >= adTaskState.totalAds) {
                    showNotification('今日广告任务已完成！', 'success');
                    return;
                }
                
                // 显示加载状态
                watchBtn.disabled = true;
                watchBtn.innerHTML = '<i class="fa fa-spinner fa-spin"></i><span>观看中...</span>';
                
                // 模拟广告观看过程（3秒）
                setTimeout(() => {
                    // 更新广告任务状态
                    adTaskState.completedAds++;
                    
                    // 更新UI
                    updateAdProgressUI();
                    
                    // 恢复按钮状态
                    watchBtn.disabled = false;
                    watchBtn.innerHTML = originalText;
                    
                    // 显示成功提示
                    showNotification('广告观看完成！获得0.1 PI奖励', 'success');
                    
                    // 检查是否完成所有广告
                    if (adTaskState.completedAds >= adTaskState.totalAds) {
                        setTimeout(() => {
                            showNotification('恭喜完成今日所有广告任务！', 'success');
                        }, 1000);
                    }
                }, 3000);
            });

            // 更新广告进度UI
            function updateAdProgressUI() {
                const completedAdsEl = document.getElementById('completedAds');
                const progressPercentageEl = document.getElementById('progressPercentage');
                const progressBarEl = document.getElementById('progressBar');
                
                if (completedAdsEl && progressPercentageEl && progressBarEl) {
                    const percentage = Math.round((adTaskState.completedAds / adTaskState.totalAds) * 100);
                    
                    completedAdsEl.textContent = adTaskState.completedAds;
                    progressPercentageEl.textContent = percentage;
                    progressBarEl.style.width = `${percentage}%`;
                }
            }

            // 个人中心页面按钮事件
            document.getElementById('rechargeBtn').addEventListener('click', function() {
                document.getElementById('rechargeModal').classList.remove('hidden');
                const modalContent = document.getElementById('rechargeModalContent');
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            });

            document.getElementById('withdrawBtn').addEventListener('click', function() {
                document.getElementById('withdrawModal').classList.remove('hidden');
                const modalContent = document.getElementById('withdrawModalContent');
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            });

            // 复制充值地址
            document.getElementById('copyAddressBtn').addEventListener('click', function() {
                const addressInput = document.getElementById('rechargeAddress');
                addressInput.select();
                document.execCommand('copy');
                
                // 显示复制成功提示
                const btn = this;
                const originalIcon = btn.innerHTML;
                btn.innerHTML = '<i class="fa fa-check"></i>';
                btn.classList.add('text-green-500');
                
                setTimeout(() => {
                    btn.innerHTML = originalIcon;
                    btn.classList.remove('text-green-500');
                    showNotification('地址复制成功！');
                }, 500);
            });

            // 确认充值
            document.getElementById('confirmRechargeBtn').addEventListener('click', function() {
                const amount = document.getElementById('rechargeAmount').value;
                if (!amount || parseFloat(amount) <= 0) {
                    showNotification('请输入有效的充值金额', 'error');
                    return;
                }
                
                // 模拟充值请求
                showNotification('充值请求已提交，请等待处理...');
                setTimeout(() => {
                    showNotification('充值成功！金额已到账', 'success');
                    closeModal('rechargeModal');
                    document.getElementById('rechargeAmount').value = '';
                }, 2000);
            });

            // 确认提现
            document.getElementById('confirmWithdrawBtn').addEventListener('click', function() {
                const address = document.getElementById('withdrawAddress').value;
                const amount = document.getElementById('withdrawAmount').value;
                
                if (!address) {
                    showNotification('请输入提现地址', 'error');
                    return;
                }
                
                if (!amount || parseFloat(amount) <= 0) {
                    showNotification('请输入有效的提现金额', 'error');
                    return;
                }
                
                // 模拟提现请求
                showNotification('提现请求已提交，请等待处理...');
                setTimeout(() => {
                    showNotification('提现成功！金额已转出', 'success');
                    closeModal('withdrawModal');
                    document.getElementById('withdrawAddress').value = '';
                    document.getElementById('withdrawAmount').value = '';
                }, 2000);
            });

            // 全部提现按钮
            document.getElementById('withdrawAllBtn').addEventListener('click', function() {
                document.getElementById('withdrawAmount').value = '1234.56';
            });

            // 一半提现按钮
            document.getElementById('withdrawHalfBtn').addEventListener('click', function() {
                document.getElementById('withdrawAmount').value = '617.28';
            });

            // 关闭模态框
            function closeModal(modalId) {
                const modal = document.getElementById(modalId);
                const modalContent = document.getElementById(modalId + 'Content');
                
                modalContent.classList.remove('scale-100', 'opacity-100');
                modalContent.classList.add('scale-95', 'opacity-0');
                
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            }

            // 为所有关闭按钮添加事件监听
            document.querySelectorAll('.close-modal-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const modal = this.closest('.fixed');
                    const modalId = modal.id;
                    closeModal(modalId);
                });
            });

            // 显示通知
            function showNotification(message, type = 'info') {
                // 创建通知元素
                const notification = document.createElement('div');
                notification.className = `fixed top-4 right-4 z-50 px-4 py-2 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full opacity-0`;
                
                // 根据类型设置样式
                switch(type) {
                    case 'success':
                        notification.classList.add('bg-green-600', 'text-white');
                        break;
                    case 'error':
                        notification.classList.add('bg-red-600', 'text-white');
                        break;
                    default:
                        notification.classList.add('bg-blue-600', 'text-white');
                }
                
                notification.textContent = message;
                document.body.appendChild(notification);
                
                // 显示通知
                setTimeout(() => {
                    notification.classList.remove('translate-x-full', 'opacity-0');
                }, 10);
                
                // 自动隐藏
                setTimeout(() => {
                    notification.classList.add('translate-x-full', 'opacity-0');
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }

            // 信息模态框相关功能
            const infoData = {
                platformShareholders: {
                    title: '平台股东',
                    content: `
                        <p class="text-white mb-3">平台股东是派项目方限限速方格的参与者，享有以下权益：</p>
                        <ul class="list-disc list-inside space-y-2 text-white">
                            <li>平台享受总收益<span class="text-pi-yellow">50%</span>的分红权</li>
                            <li>拥有<span class="text-pi-yellow">金色</span>标识和尊贵身份</li>
                            <li>享受平台广告收益<span class="text-pi-yellow">50%</span>的收入</li>
                            <li>优先体验功能和新游戏</li>
                            <li>享受所有推广团队收益<span class="text-pi-yellow">1%</span></li>
                            <li>参与重大决策和投票权</li>
                        </ul>
                        <p class="text-white mt-3">当前平台股东总数：<span class="text-pi-yellow font-bold">3,140名</span></p>
                        <p class="text-gray-400 text-sm mt-2">成为平台股东需要持有至少1股平台股份。</p>
                    `
                },
                promotionShareholders: {
                    title: '推广股东',
                    content: `
                        <p class="text-white mb-3">推广股东，推广PI像素领地公募股东确权成为推广股东，无门槛免费加入。</p>
                        <ul class="list-disc list-inside space-y-2 text-white">
                            <li>推广股东享受平台收益<span class="text-pi-yellow">2%</span>的收益</li>
                            <li>推广股东享受平台所有推广团队<span class="text-pi-yellow">1%</span>的收入</li>
                            <li>推广股东获得自己专属标识</li>
                            <li>推广股东享受平台的权限，包括投票权、治理权</li>
                        </ul>
                        <p class="text-white mt-3">当前推广股东总数：<span class="text-pi-yellow font-bold">314名</span></p>
                        <p class="text-gray-400 text-sm mt-2">成为推广股东需要至少推荐成功9名公募账户股东。</p>
                    `
                },
                myTerritory: {
                    title: '我的领地',
                    content: `
                        <div class="space-y-4">
                            <div class="bg-gray-900 p-4 rounded-lg">
                                <div class="flex justify-between items-center mb-3">
                                    <h4 class="text-lg font-pixel text-pi-yellow">万能方格数量</h4>
                                    <span class="text-white text-xl font-bold">42 个</span>
                                </div>
                                <div class="flex gap-2">
                                    <button id="listUniversalSquaresBtn" class="flex-1 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-500 transition-colors text-sm">上架</button>
                                    <button id="transferUniversalSquaresBtn" class="flex-1 px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500 transition-colors text-sm">转移</button>
                                </div>
                            </div>
                            
                            <div class="bg-gray-900 p-4 rounded-lg">
                                <div class="flex justify-between items-center mb-3">
                                    <h4 class="text-lg font-pixel text-pi-yellow">坐标方格数量</h4>
                                    <span class="text-white text-xl font-bold">18 个</span>
                                </div>
                                <div class="flex gap-2 mb-3">
                                    <button id="viewCoordinateDetailsBtn" class="flex-1 px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-500 transition-colors text-sm">查看坐标</button>
                                    <button id="transferCoordinateSquaresBtn" class="flex-1 px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500 transition-colors text-sm">转移</button>
                                </div>
                                <div id="coordinateDetails" class="hidden bg-gray-800 p-3 rounded-lg">
                                    <div class="flex justify-between mb-2">
                                        <span class="text-white">X轴方格：</span>
                                        <span class="text-pi-yellow font-bold">12 个</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-white">Y轴方格：</span>
                                        <span class="text-pi-yellow font-bold">6 个</span>
                                    </div>
                                </div>
                                
                                <!-- 分页控制 -->
                                <div class="flex items-center justify-between mt-4">
                                    <button id="prevRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(-1)">
                                        <i class="fa fa-arrow-left mr-2"></i>上一页
                                    </button>
                                    <span id="rankingPageInfo" class="text-white font-pixel text-lg">1-10 / 30</span>
                                    <button id="nextRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(1)">
                                        下一页<i class="fa fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `
                },
                listedTerritory: {
                    title: '上架/预购领地',
                    content: `
                        <div class="space-y-4">
                            <!-- 万能方格上架信息 -->
                            <div class="bg-gray-900 p-4 rounded-lg">
                                <div class="flex justify-between items-center mb-3">
                                    <h4 class="text-lg font-pixel text-pi-yellow">万能方格</h4>
                                    <div class="text-right">
                                        <div class="text-white text-xl font-bold">25 个</div>
                                        <div class="text-pi-yellow text-sm">售价：8.5 PI/个</div>
                                    </div>
                                </div>
                                
                                <!-- 分页控制 -->
                                <div class="flex items-center justify-between mt-4">
                                    <button id="prevRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(-1)">
                                        <i class="fa fa-arrow-left mr-2"></i>上一页
                                    </button>
                                    <span id="rankingPageInfo" class="text-white font-pixel text-lg">1-10 / 30</span>
                                    <button id="nextRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(1)">
                                        下一页<i class="fa fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                                <div class="flex gap-2">
                                    <button class="purchase-btn flex-1 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-500 transition-colors text-sm" data-type="universal" data-quantity="25" data-price="8.5">购买</button>
                                    <button class="sell-btn flex-1 px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-500 transition-colors text-sm" data-type="universal" data-quantity="25" data-price="8.5">出售</button>
                                </div>
                            </div>
                            
                            <!-- 坐标方格上架信息 -->
                            <div class="bg-gray-900 p-4 rounded-lg">
                                <div class="flex justify-between items-center mb-3">
                                    <h4 class="text-lg font-pixel text-pi-yellow">坐标方格</h4>
                                    <div class="text-right">
                                        <div class="text-white text-xl font-bold">17 个</div>
                                        <div class="text-pi-yellow text-sm">售价：9.0 PI/个</div>
                                    </div>
                                </div>
                                
                                <!-- 分页控制 -->
                                <div class="flex items-center justify-between mt-4">
                                    <button id="prevRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(-1)">
                                        <i class="fa fa-arrow-left mr-2"></i>上一页
                                    </button>
                                    <span id="rankingPageInfo" class="text-white font-pixel text-lg">1-10 / 30</span>
                                    <button id="nextRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(1)">
                                        下一页<i class="fa fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                                <div class="bg-gray-800 p-3 rounded-lg mb-3">
                                    <div class="flex justify-between mb-2">
                                        <span class="text-white">X轴方格 (1-3)：</span>
                                        <span class="text-pi-yellow font-bold">12 个</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-white">Y轴方格 (4-6)：</span>
                                        <span class="text-pi-yellow font-bold">5 个</span>
                                    </div>
                                </div>
                                
                                <!-- 分页控制 -->
                                <div class="flex items-center justify-between mt-4">
                                    <button id="prevRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(-1)">
                                        <i class="fa fa-arrow-left mr-2"></i>上一页
                                    </button>
                                    <span id="rankingPageInfo" class="text-white font-pixel text-lg">1-10 / 30</span>
                                    <button id="nextRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(1)">
                                        下一页<i class="fa fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                                <div class="flex gap-2">
                                    <button class="purchase-btn flex-1 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-500 transition-colors text-sm" data-type="coordinate" data-quantity="17" data-price="9.0">购买</button>
                                    <button class="sell-btn flex-1 px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-500 transition-colors text-sm" data-type="coordinate" data-quantity="17" data-price="9.0">出售</button>
                                </div>
                            </div>
                            
                            <!-- 预购信息 -->
                            <div class="bg-gray-900 p-4 rounded-lg">
                                <div class="flex justify-between items-center mb-3">
                                    <h4 class="text-lg font-pixel text-green-400">预购信息</h4>
                                    <span class="text-white text-xl font-bold">3 个</span>
                                </div>
                                <div class="bg-gray-800 p-3 rounded-lg mb-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-white">预购价格：</span>
                                        <span class="text-green-400 font-bold">7.5 PI/个</span>
                                    </div>
                                </div>
                                
                                <!-- 分页控制 -->
                                <div class="flex items-center justify-between mt-4">
                                    <button id="prevRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(-1)">
                                        <i class="fa fa-arrow-left mr-2"></i>上一页
                                    </button>
                                    <span id="rankingPageInfo" class="text-white font-pixel text-lg">1-10 / 30</span>
                                    <button id="nextRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(1)">
                                        下一页<i class="fa fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                                <button class="w-full px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500 transition-colors text-sm">参与预购</button>
                            </div>
                        </div>
                    `
                },
                territoryIncome: {
                    title: '领地收益',
                    content: `
                        <div class="relative space-y-4">
                            <!-- 关闭按钮 -->
                            <button class="absolute top-0 right-0 w-8 h-8 flex items-center justify-center rounded-full bg-gray-800 text-gray-300 hover:bg-pi-yellow hover:text-black transition-all duration-300 transform hover:scale-110 close-income-btn" style="z-index: 10;">
                                <i class="fa fa-times"></i>
                            </button>
                            <!-- 收益统计 -->
                            <div class="bg-gray-900 p-4 rounded-lg">
                                <h4 class="text-lg font-pixel text-pi-yellow mb-3">收益统计</h4>
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-white">总出售收益：</span>
                                        <span class="text-green-400 font-bold">156.50 PI</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-white">总转移领地：</span>
                                        <span class="text-blue-400 font-bold">25 个方格</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-white">本月收益：</span>
                                        <span class="text-pi-yellow font-bold">75.00 PI</span>
                                    </div>
                                </div>
                                
                                <!-- 分页控制 -->
                                <div class="flex items-center justify-between mt-4">
                                    <button id="prevRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(-1)">
                                        <i class="fa fa-arrow-left mr-2"></i>上一页
                                    </button>
                                    <span id="rankingPageInfo" class="text-white font-pixel text-lg">1-10 / 30</span>
                                    <button id="nextRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(1)">
                                        下一页<i class="fa fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 出售记录 -->
                            <div class="bg-gray-900 p-4 rounded-lg">
                                <h4 class="text-lg font-pixel text-green-400 mb-3">出售记录</h4>
                                <div class="space-y-3">
                                    <div class="bg-gray-800 p-3 rounded-lg">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-white font-bold">万能方格</span>
                                            <span class="text-green-400 font-bold">+42.50 PI</span>
                                        </div>
                                        <div class="flex justify-between text-sm mb-1">
                                            <span class="text-gray-400">数量：5个</span>
                                            <span class="text-gray-400">单价：8.5 PI/个</span>
                                        </div>
                                        <div class="text-sm text-gray-500">2026年1月25日 14:30</div>
                                    </div>
                                    
                                    <div class="bg-gray-800 p-3 rounded-lg">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-white font-bold">坐标方格</span>
                                            <span class="text-green-400 font-bold">+54.00 PI</span>
                                        </div>
                                        <div class="flex justify-between text-sm mb-1">
                                            <span class="text-gray-400">数量：6个</span>
                                            <span class="text-gray-400">单价：9.0 PI/个</span>
                                        </div>
                                        <div class="text-sm text-gray-500">2026年1月24日 10:15</div>
                                    </div>
                                    
                                    <div class="bg-gray-800 p-3 rounded-lg">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-white font-bold">万能方格</span>
                                            <span class="text-green-400 font-bold">+60.00 PI</span>
                                        </div>
                                        <div class="flex justify-between text-sm mb-1">
                                            <span class="text-gray-400">数量：8个</span>
                                            <span class="text-gray-400">单价：7.5 PI/个</span>
                                        </div>
                                        <div class="text-sm text-gray-500">2026年1月22日 16:45</div>
                                    </div>
                                </div>
                                
                                <!-- 分页控制 -->
                                <div class="flex items-center justify-between mt-4">
                                    <button id="prevRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(-1)">
                                        <i class="fa fa-arrow-left mr-2"></i>上一页
                                    </button>
                                    <span id="rankingPageInfo" class="text-white font-pixel text-lg">1-10 / 30</span>
                                    <button id="nextRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(1)">
                                        下一页<i class="fa fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 转移记录 -->
                            <div class="bg-gray-900 p-4 rounded-lg">
                                <h4 class="text-lg font-pixel text-blue-400 mb-3">转移记录</h4>
                                <div class="space-y-3">
                                    <div class="bg-gray-800 p-3 rounded-lg">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-white font-bold">坐标方格</span>
                                            <span class="text-blue-400 font-bold">12 个</span>
                                        </div>
                                        <div class="flex justify-between text-sm mb-1">
                                            <span class="text-gray-400">坐标：X轴 1-3</span>
                                            <span class="text-gray-400">接收方：user123</span>
                                        </div>
                                        <div class="text-sm text-gray-500">2026年1月26日 09:20</div>
                                    </div>
                                    
                                    <div class="bg-gray-800 p-3 rounded-lg">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-white font-bold">万能方格</span>
                                            <span class="text-blue-400 font-bold">13 个</span>
                                        </div>
                                        <div class="flex justify-between text-sm mb-1">
                                            <span class="text-gray-400">类型：万能</span>
                                            <span class="text-gray-400">接收方：pi_fan</span>
                                        </div>
                                        <div class="text-sm text-gray-500">2026年1月23日 11:30</div>
                                    </div>
                                </div>
                                
                                <!-- 分页控制 -->
                                <div class="flex items-center justify-between mt-4">
                                    <button id="prevRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(-1)">
                                        <i class="fa fa-arrow-left mr-2"></i>上一页
                                    </button>
                                    <span id="rankingPageInfo" class="text-white font-pixel text-lg">1-10 / 30</span>
                                    <button id="nextRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(1)">
                                        下一页<i class="fa fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `
                },
                shareholderIncome: {
                    title: '股东收益',
                    content: `
                        <div class="relative bg-black rounded-lg p-0 overflow-hidden" style="max-width: 360px; margin: 0 auto;">
                            <!-- 关闭按钮 -->
                            <button class="absolute top-3 right-3 w-8 h-8 flex items-center justify-center rounded-full bg-gray-800 text-gray-300 hover:bg-pi-yellow hover:text-black transition-all duration-300 transform hover:scale-110 close-shareholder-btn" style="z-index: 10; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                                <i class="fa fa-times"></i>
                            </button>
                            <!-- 顶部背景 -->
                            <div class="bg-gradient-to-r from-purple-900 via-blue-900 to-purple-800 h-24 relative overflow-hidden">
                                <div class="absolute inset-0 opacity-20">
                                    <div class="absolute top-0 left-0 w-full h-full bg-[radial-gradient(circle_at_30%_40%,rgba(255,255,255,0.15)_0%,transparent_50%)]"></div>
                                </div>
                                <div class="absolute bottom-0 left-0 w-full p-4">
                                    <h3 class="text-white text-xl font-bold font-pixel">股东收益</h3>
                                    <div class="flex items-center mt-1">
                                        <span class="px-2 py-0.5 bg-purple-600 text-white text-xs rounded-full">公募股东</span>
                                        <span class="text-gray-300 text-sm ml-2">持股 20 股</span>
                                    </div>
                                </div>
                                
                                <!-- 分页控制 -->
                                <div class="flex items-center justify-between mt-4">
                                    <button id="prevRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(-1)">
                                        <i class="fa fa-arrow-left mr-2"></i>上一页
                                    </button>
                                    <span id="rankingPageInfo" class="text-white font-pixel text-lg">1-10 / 30</span>
                                    <button id="nextRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(1)">
                                        下一页<i class="fa fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 收益统计卡片 -->
                            <div class="p-4 space-y-4">
                                <!-- 今日收益 -->
                                <div class="bg-gray-900 rounded-xl p-4 border border-gray-800">
                                    <h4 class="text-gray-400 text-sm font-medium mb-3">今日收益明细</h4>
                                    <div class="space-y-3">
                                        <div class="flex justify-between items-center">
                                            <span class="text-white text-sm">WEB3广告收益</span>
                                            <span class="text-green-400 font-bold">+2.22 PI</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-white text-sm">团队推广分红</span>
                                            <span class="text-green-400 font-bold">+1.67 PI</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-white text-sm">平台收益分红</span>
                                            <span class="text-green-400 font-bold">+1.66 PI</span>
                                        </div>
                                        <div class="border-t border-gray-700 pt-3 mt-1">
                                            <div class="flex justify-between items-center">
                                                <span class="text-white font-medium">今日合计</span>
                                                <span class="text-green-400 text-lg font-bold">+5.55 PI</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 分页控制 -->
                                <div class="flex items-center justify-between mt-4">
                                    <button id="prevRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(-1)">
                                        <i class="fa fa-arrow-left mr-2"></i>上一页
                                    </button>
                                    <span id="rankingPageInfo" class="text-white font-pixel text-lg">1-10 / 30</span>
                                    <button id="nextRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(1)">
                                        下一页<i class="fa fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                                
                                <!-- 累计统计 -->
                                <div class="grid grid-cols-3 gap-3">
                                    <div class="bg-gray-900 rounded-lg p-3 text-center border border-gray-800">
                                        <div class="text-gray-400 text-xs">本周</div>
                                        <div class="text-white font-bold text-lg mt-1">38.85</div>
                                        <div class="text-green-400 text-xs">PI</div>
                                    </div>
                                    <div class="bg-gray-900 rounded-lg p-3 text-center border border-gray-800">
                                        <div class="text-gray-400 text-xs">本月</div>
                                        <div class="text-white font-bold text-lg mt-1">166.50</div>
                                        <div class="text-green-400 text-xs">PI</div>
                                    </div>
                                    <div class="bg-gray-900 rounded-lg p-3 text-center border border-gray-800">
                                        <div class="text-gray-400 text-xs">累计</div>
                                        <div class="text-white font-bold text-lg mt-1">1,250</div>
                                        <div class="text-green-400 text-xs">PI</div>
                                    </div>
                                </div>
                                
                                <!-- 分页控制 -->
                                <div class="flex items-center justify-between mt-4">
                                    <button id="prevRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(-1)">
                                        <i class="fa fa-arrow-left mr-2"></i>上一页
                                    </button>
                                    <span id="rankingPageInfo" class="text-white font-pixel text-lg">1-10 / 30</span>
                                    <button id="nextRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(1)">
                                        下一页<i class="fa fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                                
                                <!-- 持股价值 -->
                                <div class="bg-gradient-to-r from-gray-900 to-gray-800 rounded-lg p-3 border border-gray-700">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <div class="text-gray-400 text-xs">持股价值</div>
                                            <div class="text-white font-bold text-lg">20.00 PI</div>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-gray-400 text-xs">收益率</div>
                                            <div class="text-green-400 font-bold">4.63%</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 分页控制 -->
                                <div class="flex items-center justify-between mt-4">
                                    <button id="prevRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(-1)">
                                        <i class="fa fa-arrow-left mr-2"></i>上一页
                                    </button>
                                    <span id="rankingPageInfo" class="text-white font-pixel text-lg">1-10 / 30</span>
                                    <button id="nextRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(1)">
                                        下一页<i class="fa fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `
                }
            };

            // 显示信息模态框
            function showInfoModal(type) {
                const modal = document.getElementById('infoModal');
                const modalContent = document.getElementById('infoModalContent');
                const modalTitle = document.getElementById('infoModalTitle');
                const modalBody = document.getElementById('infoModalBody');
                
                const data = infoData[type];
                if (data) {
                    modalTitle.textContent = data.title;
                    modalBody.innerHTML = data.content;
                    
                    modal.classList.remove('hidden');
                    setTimeout(() => {
                        modalContent.classList.remove('scale-95', 'opacity-0');
                        modalContent.classList.add('scale-100', 'opacity-100');
                    }, 10);
                }
            }

            // 为信息按钮添加事件监听
            document.getElementById('platformShareholdersBtn').addEventListener('click', () => showInfoModal('platformShareholders'));
            document.getElementById('promotionShareholdersBtn').addEventListener('click', () => showInfoModal('promotionShareholders'));
            document.getElementById('myTerritoryBtn').addEventListener('click', () => showInfoModal('myTerritory'));
            document.getElementById('listedTerritoryBtn').addEventListener('click', () => showInfoModal('listedTerritory'));
            document.getElementById('territoryIncomeBtn').addEventListener('click', () => showInfoModal('territoryIncome'));
            document.getElementById('shareholderIncomeBtn').addEventListener('click', () => showInfoModal('shareholderIncome'));

            // 生态系统相关功能
            let currentEcosystemUrl = '';

            // 显示关于我们模态框
            function showAboutUsModal() {
                const modal = document.getElementById('aboutUsModal');
                const modalContent = document.getElementById('aboutUsModalContent');
                
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            }

            // 显示生态跳转确认模态框
            function showEcosystemConfirmModal(ecosystemName, url) {
                const modal = document.getElementById('ecosystemConfirmModal');
                const modalContent = document.getElementById('ecosystemConfirmModalContent');
                const confirmText = document.getElementById('ecosystemConfirmText');
                
                confirmText.textContent = `是否前往${ecosystemName}？`;
                currentEcosystemUrl = url;
                
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            }

            // 关闭模态框
            function closeModal(modalId) {
                const modal = document.getElementById(modalId);
                const modalContent = document.getElementById(modalId + 'Content');
                
                modalContent.classList.remove('scale-100', 'opacity-100');
                modalContent.classList.add('scale-95', 'opacity-0');
                
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            }

            // 关于我们按钮点击事件
            document.getElementById('aboutUsBtn').addEventListener('click', showAboutUsModal);

            // 月光宝盒按钮点击事件
            document.getElementById('moonBoxBtn').addEventListener('click', function() {
                showEcosystemConfirmModal('月光宝盒', 'https://moonbox.pi');
            });

            // 派信娱乐按钮点击事件
            document.getElementById('piGameBtn').addEventListener('click', function() {
                showEcosystemConfirmModal('派信娱乐', 'https://pigame.pi');
            });

            // 派之声按钮点击事件
            document.getElementById('piVoiceBtn').addEventListener('click', function() {
                showEcosystemConfirmModal('派之声', 'https://pivoice.pi');
            });

            // 确认跳转按钮点击事件
            document.getElementById('confirmEcosystemBtn').addEventListener('click', function() {
                if (currentEcosystemUrl) {
                    window.open(currentEcosystemUrl, '_blank');
                    closeModal('ecosystemConfirmModal');
                    currentEcosystemUrl = '';
                }
            });

            // 取消跳转按钮点击事件
            document.getElementById('cancelEcosystemBtn').addEventListener('click', function() {
                closeModal('ecosystemConfirmModal');
                currentEcosystemUrl = '';
            });

            // 为所有关闭按钮添加事件监听
            document.querySelectorAll('#aboutUsModal .close-modal-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    closeModal('aboutUsModal');
                });
            });

            document.getElementById('aboutUsBtn').addEventListener('click', function() {
                alert('关于我们功能将在后续版本中实现');
            });

            // 图片上传功能
            const uploadArea = document.getElementById('uploadArea');
            const imageUpload = document.getElementById('imageUpload');
            
            uploadArea.addEventListener('click', function() {
                imageUpload.click();
            });
            
            imageUpload.addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    const file = e.target.files[0];
                    
                    // 检查文件类型
                    if (!file.type.match('image.*')) {
                        alert('请选择图片文件！');
                        return;
                    }
                    
                    // 创建预览
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        uploadArea.innerHTML = `
                            <img src="${e.target.result}" alt="上传的图片" class="max-w-full max-h-full object-contain">
                        `;
                        alert('图片上传成功！');
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
        
        // 处理Canvas鼠标移动事件
        function handleCanvasMouseMove(e) {
            const canvas = document.getElementById('pixelMap');
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            // 如果正在拖动地图
            if (isDragging) {
                // 添加平滑拖拽效果
                const dragSensitivity = 1.0;
                panX += (mouseX - lastMouseX) * dragSensitivity;
                panY += (mouseY - lastMouseY) * dragSensitivity;
                lastMouseX = mouseX;
                lastMouseY = mouseY;
                renderMap();
                return;
            }
            
            // 如果正在拖动单个像素块
            if (isPixelDragging && currentSelectedPixel) {
                // 计算新的地图坐标
                const newMapX = Math.floor((mouseX - panX) / (PIXEL_SIZE_PX * zoom));
                const newMapY = Math.floor((mouseY - panY) / (PIXEL_SIZE_PX * zoom));
                
                // 检查新坐标是否在地图范围内
                if (newMapX >= 0 && newMapX < MAP_SIZE_X && newMapY >= 0 && newMapY < MAP_SIZE_Y) {
                    // 更新像素块位置
                    const oldIndex = currentSelectedPixel.y * MAP_SIZE_X + currentSelectedPixel.x;
                    const newIndex = newMapY * MAP_SIZE_X + newMapX;
                    
                    // 检查目标位置是否已有像素块
                    if (pixels[newIndex] && !pixels[newIndex].isOwned) {
                        // 交换位置信息
                        const tempX = currentSelectedPixel.x;
                        const tempY = currentSelectedPixel.y;
                        
                        currentSelectedPixel.x = newMapX;
                        currentSelectedPixel.y = newMapY;
                        currentSelectedPixel.id = `pixel_${newMapX}_${newMapY}`;
                        
                        // 更新像素数组
                        pixels[oldIndex] = {
                            id: `pixel_${tempX}_${tempY}`,
                            x: tempX,
                            y: tempY,
                            color: '#FFFFFF',
                            isOwned: false,
                            owner: null
                        };
                        
                        pixels[newIndex] = currentSelectedPixel;
                        
                        // 更新弹窗中的坐标信息
                        if (document.getElementById('pixelInfoModal').classList.contains('hidden') === false) {
                            document.getElementById('modalPixelCoords').textContent = `X: ${newMapX}, Y: ${newMapY}`;
                        }
                        
                        renderMap();
                    }
                }
                return;
            }
            
            // 转换为地图坐标
            const mapX = Math.floor((mouseX - panX) / (PIXEL_SIZE_PX * zoom));
            const mapY = Math.floor((mouseY - panY) / (PIXEL_SIZE_PX * zoom));
            
            // 检查坐标是否在地图范围内
            if (mapX >= 0 && mapX < MAP_SIZE_X && mapY >= 0 && mapY < MAP_SIZE_Y) {
                // 更改鼠标样式
                canvas.style.cursor = 'grab';
                
                // 更新悬停的像素块
                const pixelIndex = mapY * MAP_SIZE_X + mapX;
                hoveredPixel = pixels[pixelIndex];
                renderMap();
            } else {
                // 恢复默认鼠标样式
                canvas.style.cursor = 'default';
                hoveredPixel = null;
                renderMap();
            }
        }
        
        // 登录相关函数
        function openLoginModal() {
            document.getElementById('loginModal').classList.remove('hidden');
        }
        
        function closeLoginModal() {
            document.getElementById('loginModal').classList.add('hidden');
            // 重置登录状态
            document.getElementById('usernameInputArea').classList.add('hidden');
            document.getElementById('confirmLoginBtn').classList.add('hidden');
            document.getElementById('piUsername').value = '';
        }
        
        function handlePiAuthSelection() {
            // 显示用户名输入区域
            document.getElementById('usernameInputArea').classList.remove('hidden');
            document.getElementById('confirmLoginBtn').classList.remove('hidden');
            document.getElementById('piUsername').focus();
        }
        
        function handleUsernameInput() {
            const username = document.getElementById('piUsername').value.trim();
            const confirmBtn = document.getElementById('confirmLoginBtn');
            
            // 只有当用户名不为空时才启用确认按钮
            if (username.length > 0) {
                confirmBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                confirmBtn.disabled = false;
            } else {
                confirmBtn.classList.add('opacity-50', 'cursor-not-allowed');
                confirmBtn.disabled = true;
            }
        }
        
        function handlePiAuthConfirm() {
            const username = document.getElementById('piUsername').value.trim();
            
            if (username.length > 0) {
                // 模拟登录成功
                alert(`PI账号授权成功！欢迎，${username}！`);
                
                // 更新UI显示登录状态和下拉菜单
                const headerRight = document.querySelector('.container.mx-auto.flex.justify-between.items-center > div:last-child');
                headerRight.innerHTML = `
                    <div class="relative" id="userDropdownContainer">
                        <button id="userDropdownBtn" class="px-3 py-1 bg-pi-yellow text-black rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 flex items-center gap-1 text-sm">
                            <i class="fa fa-user-circle"></i>
                            <span>${username}</span>
                            <i class="fa fa-caret-down text-xs"></i>
                        </button>
                        <div id="userDropdownMenu" class="absolute right-0 mt-2 w-40 bg-gray-900 rounded-lg shadow-xl border border-gray-700 hidden z-50">
                            <div class="py-1">
                                <button id="logoutBtn" class="w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-800 transition-colors">
                                    <i class="fa fa-sign-out mr-2"></i>退出登录
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                // 添加下拉菜单事件监听
                const dropdownBtn = document.getElementById('userDropdownBtn');
                const dropdownMenu = document.getElementById('userDropdownMenu');
                const logoutBtn = document.getElementById('logoutBtn');
                
                dropdownBtn.addEventListener('click', () => {
                    dropdownMenu.classList.toggle('hidden');
                });
                
                // 为用户按钮添加双击退出功能
                dropdownBtn.addEventListener('dblclick', handleLogout);
                
                logoutBtn.addEventListener('click', () => {
                    // 清除登录状态并返回初始登录选择界面
                    const headerRight = document.querySelector('.container.mx-auto.flex.justify-between.items-center > div:last-child');
                    headerRight.innerHTML = `
                        <button id="loginBtn" class="px-3 py-1 bg-pi-yellow text-black rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105 active:scale-95 text-sm">
                            <i class="fa fa-user-circle mr-1"></i>登录
                        </button>
                    `;
                    
                    // 重新添加登录事件监听
                    document.getElementById('loginBtn').addEventListener('click', openLoginModal);
                    
                    // 打开登录模态框
                    openLoginModal();
                });
                
                // 点击页面其他地方关闭下拉菜单
                document.addEventListener('click', (e) => {
                    if (!document.getElementById('userDropdownContainer').contains(e.target)) {
                        dropdownMenu.classList.add('hidden');
                    }
                });
                
                // 关闭登录模态框
                closeLoginModal();
                
                // 播放成功音效
                playSuccessSound();
            }
        }
        
        // 处理退出登录
        function handleLogout() {
            // 确认退出
            if (confirm('确定要退出登录吗？')) {
                // 恢复登录按钮
                const headerRight = document.querySelector('.container.mx-auto.flex.justify-between.items-center > div:last-child');
                headerRight.innerHTML = `
                    <button id="loginBtn" class="px-3 py-1 bg-pi-yellow text-black rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105 active:scale-95 text-sm">
                        <i class="fa fa-user-circle mr-1"></i>登录
                    </button>
                `;
                
                // 重新添加登录事件监听
                document.getElementById('loginBtn').addEventListener('click', openLoginModal);
            }
        }
        
        // 处理签到功能
        function handleCheckIn() {
            // 检查用户是否已登录
            const loginBtn = document.getElementById('loginBtn');
            if (loginBtn) {
                // 用户未登录，提示登录
                alert('请先登录以进行签到');
                openLoginModal();
                return;
            }
            
            // 模拟签到逻辑
            const username = document.querySelector('#userDropdownBtn span').textContent;
            
            // 检查是否已经签到
            const lastCheckInDate = localStorage.getItem(`lastCheckIn_${username}`);
            const today = new Date().toDateString();
            
            if (lastCheckInDate === today) {
                alert('您今天已经签到过了！');
                return;
            }
            
            // 模拟签到奖励
            const reward = Math.random() * 0.5 + 0.1; // 0.1-0.6 PI的随机奖励
            const formattedReward = reward.toFixed(2);
            
            // 保存签到记录
            localStorage.setItem(`lastCheckIn_${username}`, today);
            
            // 显示签到成功消息
            alert(`签到成功！\n\n用户：${username}\n奖励：${formattedReward} PI\n\n继续保持每日签到，获得更多奖励！`);
            
            // 播放成功音效
            playSuccessSound();
        }
        
        // 导航按钮处理函数
        function handleHomeClick() {
            showPage('homePage');
        }
        
        function handleAchievementsClick() {
            showPage('achievementsPage');
        }
        
        function handleProfileClick() {
            showPage('profilePage');
        }
        
        // 显示指定页面
        function showPage(pageId) {
            // 隐藏所有页面
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // 显示指定页面
            document.getElementById(pageId).classList.add('active');
            
            // 处理首页特定元素的显示/隐藏
            if (pageId === 'homePage' || pageId === 'achievementsPage') {
                // 显示首页特定元素（仅首页显示）
                if (pageId === 'homePage') {
                    document.getElementById('homeSpecificElements').style.display = 'block';
                } else {
                    document.getElementById('homeSpecificElements').style.display = 'none';
                }
                
                // 添加顶部按钮
                const headerButtons = document.getElementById('headerButtons');
                let buttonsHTML = `<div class="flex items-center gap-3">`;
                
                if (pageId === 'homePage') {
                    // 首页只显示登录按钮
                    buttonsHTML += `
                        <button id="loginBtn" class="px-4 py-1 bg-pi-yellow text-black rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105 active:scale-95 text-sm flex items-center gap-1">
                            <i class="fa fa-user-circle"></i>
                            <span>登录</span>
                        </button>
                    `;
                } else if (pageId === 'achievementsPage') {
                    // 全民收益页面显示签到和抽奖按钮
                    buttonsHTML += `
                        <button id="signInButton" class="px-4 py-1 bg-pi-yellow text-black rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105 active:scale-95 text-sm flex items-center gap-1">
                            <i class="fa fa-calendar-check-o"></i>
                            <span>签到</span>
                        </button>
                        <button id="lotteryBtn" class="px-4 py-1 bg-purple-600 text-white rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105 active:scale-95 text-sm flex items-center gap-1">
                            <i class="fa fa-gift"></i>
                            <span>抽奖</span>
                        </button>
                    `;
                }
                
                buttonsHTML += `</div>`;
                headerButtons.innerHTML = buttonsHTML;
                
                // 重新添加按钮事件监听器
                if (pageId === 'homePage') {
                    document.getElementById('loginBtn').addEventListener('click', openLoginModal);
                }
                
                // 全民收益页面添加签到和抽奖按钮事件
                if (pageId === 'achievementsPage') {
                    // 签到按钮事件
                    document.getElementById('signInButton').addEventListener('click', function() {
                        // 生成随机坐标（在有效范围内）
                        const x = Math.floor(Math.random() * 180) + 10; // 10-189
                        const y = Math.floor(Math.random() * 180) + 10; // 10-189
                        
                        // 显示签到成功提示
                        const modal = document.createElement('div');
                        modal.className = 'fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50';
                        modal.innerHTML = `
                            <div class="bg-black rounded-lg p-6 border border-pi-yellow max-w-md w-full transform transition-all duration-300 scale-100 opacity-100" style="box-shadow: 0 0 30px rgba(255, 193, 7, 0.5);">
                                <div class="text-center">
                                    <div class="text-pi-yellow text-5xl mb-4">
                                        <i class="fa fa-trophy"></i>
                                    </div>
                                    <h3 class="text-xl font-pixel text-pi-yellow mb-3">签到成功！</h3>
                                    <p class="text-white mb-4">恭喜您获得一个像素方格！</p>
                                    <div class="bg-gray-900 p-4 rounded-lg mb-4">
                                        <p class="text-gray-400 text-sm mb-1">坐标位置</p>
                                        <p class="text-white text-lg font-pixel">X: ${x}, Y: ${y}</p>
                                    </div>
                                    <button id="closeSignInModal" class="px-6 py-2 bg-pi-yellow text-black rounded-lg hover:bg-yellow-400 transition-colors duration-200 font-pixel text-sm">
                                        确定
                                    </button>
                                </div>
                            </div>
                        `;
                        document.body.appendChild(modal);
                        
                        document.getElementById('closeSignInModal').addEventListener('click', function() {
                            modal.remove();
                        });
                        
                        if (gameState && gameState.currentUser) {
                            gameState.currentUser.pixelCount++;
                        }
                        
                        if (typeof updateStatusDisplay === 'function') {
                            updateStatusDisplay();
                        }
                    });
                    
                    // 抽奖按钮事件
                    const lotteryBtn = document.getElementById('lotteryBtn');
                    if (lotteryBtn) {
                        lotteryBtn.addEventListener('click', function() {
                            // 显示抽奖提示
                            const modal = document.createElement('div');
                            modal.className = 'fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50';
                            modal.innerHTML = `
                                <div class="bg-black rounded-lg p-6 border border-purple-600 max-w-md w-full transform transition-all duration-300 scale-100 opacity-100" style="box-shadow: 0 0 30px rgba(123, 31, 162, 0.5);">
                                    <div class="text-center">
                                        <div class="text-purple-500 text-5xl mb-4">
                                            <i class="fa fa-gift"></i>
                                        </div>
                                        <h3 class="text-xl font-pixel text-purple-500 mb-3">抽奖功能</h3>
                                        <p class="text-white mb-4">抽奖功能即将上线，敬请期待！</p>
                                        <button id="closeLotteryModal" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-500 transition-colors duration-200 font-pixel text-sm">
                                            确定
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- 分页控制 -->
                                <div class="flex items-center justify-between mt-4">
                                    <button id="prevRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(-1)">
                                        <i class="fa fa-arrow-left mr-2"></i>上一页
                                    </button>
                                    <span id="rankingPageInfo" class="text-white font-pixel text-lg">1-10 / 30</span>
                                    <button id="nextRankingBtn" class="text-base font-pixel text-pi-yellow bg-black bg-opacity-50 border border-pi-yellow px-4 py-2 rounded-lg hover:bg-pi-yellow hover:text-black transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50" onclick="changeRankingPage(1)">
                                        下一页<i class="fa fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                            `;
                            document.body.appendChild(modal);
                            
                            document.getElementById('closeLotteryModal').addEventListener('click', function() {
                                modal.remove();
                            });
                        });
                    }
                }
                
                // 重新渲染地图以确保正确显示（仅首页）
                if (pageId === 'homePage') {
                    setTimeout(() => {
                        if (typeof centerMap === 'function') centerMap();
                        if (typeof renderMap === 'function') renderMap();
                    }, 100);
                }
            } else {
                // 隐藏首页特定元素
                document.getElementById('homeSpecificElements').style.display = 'none';
                
                // 清空顶部按钮
                document.getElementById('headerButtons').innerHTML = '';
            }
        }
        
        // 处理Canvas点击事件
        function handleCanvasClick(e) {
            const canvas = document.getElementById('pixelMap');
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            // 转换为地图坐标
            const mapX = Math.floor((mouseX - panX) / (PIXEL_SIZE_PX * zoom));
            const mapY = Math.floor((mouseY - panY) / (PIXEL_SIZE_PX * zoom));
            
            // 检查坐标是否在地图范围内
            if (mapX >= 0 && mapX < MAP_SIZE_X && mapY >= 0 && mapY < MAP_SIZE_Y) {
                const pixelIndex = mapY * MAP_SIZE_X + mapX;
                const pixel = pixels[pixelIndex];
                
                // 播放点击音效
                playClickSound();
                
                // 检查是否是再次点击同一个方格
                if (currentSelectedPixel && currentSelectedPixel.id === pixel.id) {
                    // 再次点击，显示详细信息弹窗
                    showDetailedPixelInfo(pixel);
                } else {
                    // 首次点击，选中该方格并以其为中心放大
                    currentSelectedPixel = pixel;
                    
                    // 以点击的方格为中心放大
                    zoomToPixelCenter(pixel, mouseX, mouseY);
                }
            }
        }
        
        // 处理Canvas鼠标按下事件
        function handleCanvasMouseDown(e) {
            const canvas = document.getElementById('pixelMap');
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            // 转换为地图坐标
            const mapX = Math.floor((mouseX - panX) / (PIXEL_SIZE_PX * zoom));
            const mapY = Math.floor((mouseY - panY) / (PIXEL_SIZE_PX * zoom));
            
            // 检查是否点击在像素块上
            if (mapX >= 0 && mapX < MAP_SIZE_X && mapY >= 0 && mapY < MAP_SIZE_Y) {
                const pixelIndex = mapY * MAP_SIZE_X + mapX;
                const pixel = pixels[pixelIndex];
                
                // 如果点击的是已选中的像素块，则开始拖动该像素块
                if (pixel === currentSelectedPixel || pixel === hoveredPixel) {
                    isPixelDragging = true;
                    isDragging = false;
                    canvas.style.cursor = 'move';
                } else {
                    // 否则开始拖动地图
                    isDragging = true;
                    isPixelDragging = false;
                    canvas.style.cursor = 'grabbing';
                }
            } else {
                // 点击在空白区域，拖动地图
                isDragging = true;
                isPixelDragging = false;
                canvas.style.cursor = 'grabbing';
            }
            
            lastMouseX = mouseX;
            lastMouseY = mouseY;
            
            // 阻止默认行为和冒泡，提高拖拽体验
            e.preventDefault();
        }
        
        // 处理Canvas鼠标释放事件
        function handleCanvasMouseUp() {
            isDragging = false;
            isPixelDragging = false;
            document.getElementById('pixelMap').style.cursor = 'default';
        }

        // 处理Canvas触摸开始事件
        function handleCanvasTouchStart(e) {
            e.preventDefault();
            const canvas = document.getElementById('pixelMap');
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const touchX = touch.clientX - rect.left;
            const touchY = touch.clientY - rect.top;
            
            // 转换为地图坐标
            const mapX = Math.floor((touchX - panX) / (PIXEL_SIZE_PX * zoom));
            const mapY = Math.floor((touchY - panY) / (PIXEL_SIZE_PX * zoom));
            
            // 检查是否点击在像素块上
            if (mapX >= 0 && mapX < MAP_SIZE_X && mapY >= 0 && mapY < MAP_SIZE_Y) {
                const pixelIndex = mapY * MAP_SIZE_X + mapX;
                const pixel = pixels[pixelIndex];
                
                // 如果点击的是已选中的像素块，则开始拖动该像素块
                if (pixel === currentSelectedPixel || pixel === hoveredPixel) {
                    isPixelDragging = true;
                    isDragging = false;
                } else {
                    // 否则开始拖动地图
                    isDragging = true;
                    isPixelDragging = false;
                }
            } else {
                // 点击在空白区域，拖动地图
                isDragging = true;
                isPixelDragging = false;
            }
            
            lastMouseX = touchX;
            lastMouseY = touchY;
        }

        // 处理Canvas触摸移动事件
        function handleCanvasTouchMove(e) {
            e.preventDefault();
            if (!isDragging && !isPixelDragging) return;
            
            const canvas = document.getElementById('pixelMap');
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const touchX = touch.clientX - rect.left;
            const touchY = touch.clientY - rect.top;
            
            // 计算移动距离
            const deltaX = touchX - lastMouseX;
            const deltaY = touchY - lastMouseY;
            
            if (isDragging) {
                // 拖动地图
                panX += deltaX;
                panY += deltaY;
                renderMap();
            } else if (isPixelDragging && currentSelectedPixel) {
                // 拖动像素块（如果需要）
                // 这里可以添加拖动像素块的逻辑
            }
            
            lastMouseX = touchX;
            lastMouseY = touchY;
        }

        // 处理Canvas触摸结束事件
        function handleCanvasTouchEnd(e) {
            e.preventDefault();
            isDragging = false;
            isPixelDragging = false;
        }
        
        // 处理Canvas滚轮事件
        function handleCanvasWheel(e) {
            e.preventDefault();
            
            // 获取鼠标在Canvas中的位置
            const rect = e.target.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            // 计算鼠标位置相对于平移和缩放后的地图的比例
            const mouseXRatio = (mouseX - panX) / (CANVAS_WIDTH * zoom);
            const mouseYRatio = (mouseY - panY) / (CANVAS_HEIGHT * zoom);
            
            // 根据滚轮方向调整缩放级别
            if (e.deltaY < 0) {
                // 放大
                zoom = Math.min(zoom * 1.1, 1.0);
            } else {
                // 缩小
                zoom = Math.max(zoom / 1.1, 0.1);
            }
            
            // 调整平移以保持鼠标位置不变
            panX = mouseX - mouseXRatio * CANVAS_WIDTH * zoom;
            panY = mouseY - mouseYRatio * CANVAS_HEIGHT * zoom;
            
            renderMap();
        }
        
        // 以点击位置为中心放大显示选中的像素块
        function zoomToPixelCenter(pixel, mouseX, mouseY) {
            // 保存当前缩放级别
            const oldZoom = zoom;
            
            // 设置新的缩放级别
            zoom = Math.min(oldZoom * 1.5, 1.0);
            
            // 计算鼠标位置相对于平移和缩放后的地图的比例
            const mouseXRatio = (mouseX - panX) / (CANVAS_WIDTH * oldZoom);
            const mouseYRatio = (mouseY - panY) / (CANVAS_HEIGHT * oldZoom);
            
            // 调整平移以保持鼠标位置不变
            panX = mouseX - mouseXRatio * CANVAS_WIDTH * zoom;
            panY = mouseY - mouseYRatio * CANVAS_HEIGHT * zoom;
            
            // 重新渲染地图
            renderMap();
        }

        // 自动放大并居中显示选中的像素块
        function zoomToPixel(pixel) {
            // 保存当前缩放级别
            const oldZoom = zoom;
            
            // 设置新的缩放级别
            zoom = Math.min(oldZoom * 1.5, 1.0);
            
            // 计算像素块在画布中的中心位置
            const pixelCenterX = pixel.x * PIXEL_SIZE_PX * zoom;
            const pixelCenterY = pixel.y * PIXEL_SIZE_PX * zoom;
            
            // 获取容器尺寸
            const canvas = document.getElementById('pixelMap');
            const containerWidth = canvas.parentElement.clientWidth;
            const containerHeight = canvas.parentElement.clientHeight;
            
            // 计算新的平移位置，使像素块居中
            panX = (containerWidth / 2) - pixelCenterX;
            panY = (containerHeight / 2) - pixelCenterY;
            
            // 重新渲染地图
            renderMap();
        }
        
        // 播放点击音效
        function playClickSound() {
            try {
                // 创建音频上下文
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // 创建振荡器
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                // 连接节点
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // 设置音频参数
                oscillator.type = 'sine';
                oscillator.frequency.value = 800;
                gainNode.gain.value = 0.1;
                
                // 开始播放
                oscillator.start();
                
                // 0.1秒后停止
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (e) {
                // 静音模式或不支持音频时忽略
                console.log('音频播放失败:', e);
            }
        }
        
        // 播放成功音效
        function playSuccessSound() {
            try {
                // 创建音频上下文
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // 创建振荡器
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                // 连接节点
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // 设置音频参数
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + 0.3);
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                // 播放音效
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } catch (e) {
                // 静音模式或不支持音频时忽略
                console.log('音频播放失败:', e);
            }
        }
        
        // 显示详细的像素块信息弹窗
        function showDetailedPixelInfo(pixel) {
            // 更新弹窗信息
            document.getElementById('modalPixelCoords').textContent = `X: ${pixel.x}, Y: ${pixel.y}`;
            
            // 设置状态文本
            let statusText = '空白';
            if (pixel.isOwned) {
                if (pixel.isSystemProtected) {
                    statusText = '系统保护区域';
                } else if (pixel.owner === 'platform') {
                    statusText = '平台股东权限才可绘制';
                } else {
                    statusText = pixel.isOnSale ? '已上架' : '已购买';
                }
            }
            document.getElementById('modalPixelStatus').textContent = statusText;
            
            // 设置规格信息
            document.getElementById('modalPixelSpec').textContent = `${PIXEL_SIZE_CM}×${PIXEL_SIZE_CM} 厘米`;
            
            // 设置价格（中心区域显示统一价格）
            if (pixel.isCenterArea) {
                document.getElementById('modalPixelPrice').textContent = `31415926535 π`;
            } else {
                document.getElementById('modalPixelPrice').textContent = `${PIXEL_PRICE} π`;
            }
            
            // 设置备注信息
            document.getElementById('modalPixelNote').textContent = pixel.note ? pixel.note : '无';
            
            // 重置弹窗UI状态
            document.getElementById('buyPixelBtn').classList.remove('hidden');
            document.getElementById('colorPickerContainer').classList.add('hidden');
            document.getElementById('editColorBtn').classList.add('hidden');
            
            // 根据区域类型设置不同的操作权限
            if (pixel.isSystemProtected) {
                // 系统保护的边框区域：只显示关闭按钮
                document.getElementById('buyPixelBtn').classList.add('hidden');
            } else if (pixel.isPlatformOnly) {
                // 平台专属区域：隐藏购买按钮
                document.getElementById('buyPixelBtn').classList.add('hidden');
            } else {
                // 普通区域：正常显示购买和编辑功能
                if (pixel.isOwned && pixel.owner === 'currentUser') {
                    document.getElementById('buyPixelBtn').classList.add('hidden');
                    document.getElementById('colorPickerContainer').classList.remove('hidden');
                    document.getElementById('editColorBtn').classList.remove('hidden');
                    generateModalColorPalette();
                }
            }
            
            // 更新历史记录
            updateTransactionHistory(pixel);
            
            // 更新购买按钮状态
            const buyBtn = document.getElementById('buyPixelBtn');
            if (pixel.isOwned) {
                buyBtn.disabled = true;
                buyBtn.classList.add('opacity-50');
                buyBtn.textContent = pixel.isOnSale ? '已上架' : '已购买';
            } else {
                buyBtn.disabled = false;
                buyBtn.classList.remove('opacity-50');
                buyBtn.innerHTML = '<i class="fa fa-shopping-cart mr-1"></i>购买';
            }
            
            // 显示弹窗
            document.getElementById('pixelInfoModal').classList.remove('hidden');
        }
        
        // 更新交易历史记录
        function updateTransactionHistory(pixel) {
            const historyContainer = document.getElementById('transactionHistoryList');
            historyContainer.innerHTML = '';
            
            if (pixel.transactionHistory && pixel.transactionHistory.length > 0) {
                // 显示最近的3条交易记录
                const recentHistory = pixel.transactionHistory.slice(-3);
                
                recentHistory.forEach(transaction => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'transaction-item';
                    
                    const date = new Date(transaction.timestamp);
                    const dateStr = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
                    
                    historyItem.innerHTML = `
                        <div class="flex justify-between">
                            <span>${transaction.type}</span>
                            <span class="text-gray-400">${dateStr}</span>
                        </div>
                        <div class="text-sm text-gray-400">${transaction.description}</div>
                    `;
                    
                    historyContainer.appendChild(historyItem);
                });
            } else {
                const emptyItem = document.createElement('div');
                emptyItem.className = 'transaction-item text-center text-gray-500 text-sm';
                emptyItem.textContent = '暂无交易记录';
                historyContainer.appendChild(emptyItem);
            }
        }
        
        // 关闭像素块信息弹窗
        function closePixelInfoModal() {
            document.getElementById('pixelInfoModal').classList.add('hidden');
            currentSelectedPixel = null;
        }
        
        // 处理购买像素块
        function handleBuyPixel() {
            if (!currentSelectedPixel) return;
            
            // 检查是否是系统保护区域
            if (currentSelectedPixel.isSystemProtected) {
                alert('此区域为系统保护的黑色边框，任何人都无法修改！');
                return;
            }
            
            // 检查是否是平台专属区域
            if (currentSelectedPixel.isPlatformOnly) {
                alert('此区域仅平台股东可操作，普通用户无权限购买！');
                return;
            }
            
            // 模拟购买过程
            currentSelectedPixel.isOwned = true;
            currentSelectedPixel.owner = 'currentUser';
            currentSelectedPixel.color = selectedColor;
            
            // 添加交易记录
            currentSelectedPixel.transactionHistory.push({
                type: '购买',
                timestamp: new Date(),
                description: `用户 currentUser 购买了此像素块，价格 ${PIXEL_PRICE} π`
            });
            
            // 更新弹窗状态
            document.getElementById('modalPixelStatus').textContent = '已购买';
            
            // 更新交易历史
            updateTransactionHistory(currentSelectedPixel);
            
            // 隐藏购买按钮，显示颜色选择器和上色按钮
            document.getElementById('buyPixelBtn').classList.add('hidden');
            document.getElementById('colorPickerContainer').classList.remove('hidden');
            document.getElementById('editColorBtn').classList.remove('hidden');
            
            // 生成颜色选择器
            generateModalColorPalette();
            
            // 重新渲染地图
            renderMap();
            updateStats();
            
            // 显示购买成功提示
            setTimeout(() => {
                alert('购买成功！您可以为像素块选择任意颜色。');
            }, 500);
        }
        
        // 生成弹窗中的颜色选择器
        function generateModalColorPalette() {
            const colorPalette = document.getElementById('modalColorPalette');
            colorPalette.innerHTML = '';
            
            // 添加预定义颜色
            predefinedColors.forEach((color, index) => {
                const colorDiv = document.createElement('div');
                colorDiv.className = 'w-6 h-6 border border-black cursor-pointer transition-transform hover:scale-110';
                colorDiv.style.backgroundColor = color;
                colorDiv.dataset.color = color;
                
                // 添加点击事件
                colorDiv.addEventListener('click', () => {
                    // 更新当前选中的颜色
                    selectedColor = color;
                    
                    // 更新UI
                    document.querySelectorAll('#modalColorPalette div').forEach(div => {
                        div.classList.remove('ring-4', 'ring-white');
                    });
                    colorDiv.classList.add('ring-4', 'ring-white');
                });
                
                colorPalette.appendChild(colorDiv);
            });
            
            // 默认选中第一个颜色
            if (predefinedColors.length > 0) {
                selectedColor = predefinedColors[0];
                colorPalette.children[0].classList.add('ring-4', 'ring-white');
            }
            
            // 添加上色按钮事件
            document.getElementById('editColorBtn').addEventListener('click', handleEditColor);
        }
        
        // 处理上色功能
        function handleEditColor() {
            if (!currentSelectedPixel) return;
            
            // 检查是否是系统保护区域
            if (currentSelectedPixel.isSystemProtected) {
                alert('此区域为系统保护的黑色边框，任何人都无法修改！');
                return;
            }
            
            // 检查是否是平台专属区域
            if (currentSelectedPixel.isPlatformOnly) {
                alert('此区域仅平台股东可操作，普通用户无权限上色！');
                return;
            }
            
            // 更新像素块颜色
            currentSelectedPixel.color = selectedColor;
            
            // 添加交易记录
            currentSelectedPixel.transactionHistory.push({
                type: '上色',
                timestamp: new Date(),
                description: `用户 currentUser 为像素块上色`
            });
            
            // 更新交易历史
            updateTransactionHistory(currentSelectedPixel);
            
            // 重新渲染地图
            renderMap();
            
            // 显示上色成功提示
            setTimeout(() => {
                alert('上色成功！像素块已更新为选中的颜色。');
            }, 300);
        }
        
        // 更新统计信息
        function updateStats() {
            const totalPixels = MAP_SIZE_X * MAP_SIZE_Y; // 100×100=10000
            const ownedPixels = pixels.filter(p => p.isOwned).length;
            const emptyPixels = totalPixels - ownedPixels;
            const onSalePixels = pixels.filter(p => p.isOnSale).length;
            
            // 更新UI显示
            document.getElementById('totalPixelsStat').textContent = totalPixels.toLocaleString();
            document.getElementById('emptyPixelsStat').textContent = emptyPixels.toLocaleString();
            document.getElementById('onSalePixelsStat').textContent = onSalePixels.toLocaleString();
        }
        
        // 渲染地图
        function renderMap() {
            const canvas = document.getElementById('pixelMap');
            const ctx = canvas.getContext('2d');
            
            // 清空画布
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 保存当前状态
            ctx.save();
            
            // 应用缩放和平移
            ctx.translate(panX, panY);
            ctx.scale(zoom, zoom);
            
            // 绘制像素块
            pixels.forEach(pixel => {
                // 绘制填充色
                ctx.fillStyle = pixel.color;
                ctx.fillRect(pixel.x * PIXEL_SIZE_PX, pixel.y * PIXEL_SIZE_PX, PIXEL_SIZE_PX, PIXEL_SIZE_PX);
                
                // 绘制黑色边框
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 0.5;
                ctx.strokeRect(pixel.x * PIXEL_SIZE_PX, pixel.y * PIXEL_SIZE_PX, PIXEL_SIZE_PX, PIXEL_SIZE_PX);
                
                // 如果是已购买的像素块，添加高亮效果（但中心区域不显示黄色高亮）
                if (pixel.isOwned && !pixel.isCenterArea) {
                    ctx.strokeStyle = '#FFD700';
                    ctx.lineWidth = 1;
                    ctx.strokeRect(pixel.x * PIXEL_SIZE_PX - 1, pixel.y * PIXEL_SIZE_PX - 1, PIXEL_SIZE_PX + 2, PIXEL_SIZE_PX + 2);
                }
                
                // 如果是当前选中的像素块，加粗边框
                if (pixel === currentSelectedPixel) {
                    ctx.save();
                    ctx.strokeStyle = '#000000';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.rect(
                        pixel.x * PIXEL_SIZE_PX + 0.5, 
                        pixel.y * PIXEL_SIZE_PX + 0.5, 
                        PIXEL_SIZE_PX - 1, 
                        PIXEL_SIZE_PX - 1
                    );
                    ctx.stroke();
                    ctx.restore();
                }
                
                // 如果是悬停的像素块，添加淡紫色边框
                if (pixel === hoveredPixel && pixel !== currentSelectedPixel) {
                    ctx.strokeStyle = 'rgba(128, 0, 128, 0.5)';
                    ctx.lineWidth = 1.5;
                    ctx.strokeRect(pixel.x * PIXEL_SIZE_PX - 1.5, pixel.y * PIXEL_SIZE_PX - 1.5, PIXEL_SIZE_PX + 3, PIXEL_SIZE_PX + 3);
                }
            });
            
            // 恢复状态
            ctx.restore();
        }
        
        // 触摸事件处理（移动端支持）
        function handleCanvasTouchStart(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousedown', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }
        
        function handleCanvasTouchMove(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }
        
        function handleCanvasTouchEnd(e) {
            e.preventDefault();
            const mouseEvent = new MouseEvent('mouseup', {});
            canvas.dispatchEvent(mouseEvent);
        }
        
        // 显示方格详情模态框
        function showSquareDetailModal(type) {
            const modal = document.getElementById('squareDetailModal');
            const modalContent = document.getElementById('squareDetailModalContent');
            const titleElement = document.getElementById('squareDetailTitle');
            const bodyElement = document.getElementById('squareDetailBody');
            
            // 设置标题和内容
            titleElement.textContent = MODAL_CONFIG[type].title;
            bodyElement.innerHTML = MODAL_CONFIG[type].content;
            
            // 显示模态框
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }
        
        // 隐藏方格详情模态框
        function hideSquareDetailModal() {
            const modal = document.getElementById('squareDetailModal');
            const modalContent = document.getElementById('squareDetailModalContent');
            
            // 隐藏模态框
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }
        
        // 页面加载完成后初始化
        window.addEventListener('load', function() {
            init();
            // 初始化页面显示
            showPage('homePage');
            
            // 添加新功能按钮事件监听器
            document.addEventListener('click', function(e) {
                // 查看坐标详情
                if (e.target.id === 'viewCoordinateDetailsBtn') {
                    const detailsDiv = document.getElementById('coordinateDetails');
                    detailsDiv.classList.toggle('hidden');
                    e.target.textContent = detailsDiv.classList.contains('hidden') ? '查看坐标' : '隐藏坐标';
                }
                
                // 转移功能
                if (e.target.id === 'transferUniversalSquaresBtn' || e.target.id === 'transferCoordinateSquaresBtn') {
                    const type = e.target.id.includes('Universal') ? '万能方格' : '坐标方格';
                    const quantity = e.target.id.includes('Universal') ? 42 : 18;
                    
                    const recipient = prompt(`请输入接收方的PI用户名：`);
                    if (recipient && recipient.trim()) {
                        const confirmTransfer = confirm(`确定要转移 ${quantity} 个${type}给用户 ${recipient} 吗？`);
                        if (confirmTransfer) {
                            setTimeout(() => {
                                alert(`转移成功！已将 ${quantity} 个${type}转移给用户 ${recipient}。`);
                            }, 500);
                        }
                    }
                }
                
                // 上架功能
                if (e.target.id === 'listUniversalSquaresBtn') {
                    const quantity = prompt('请输入要上架的万能方格数量（最多42个）：');
                    const numQuantity = parseInt(quantity);
                    if (quantity && !isNaN(numQuantity) && numQuantity > 0 && numQuantity <= 42) {
                        const price = prompt(`请输入每个万能方格的售价（PI）：`);
                        const numPrice = parseFloat(price);
                        if (price && !isNaN(numPrice) && numPrice > 0) {
                            const confirmList = confirm(`确定要上架 ${numQuantity} 个万能方格，售价 ${numPrice} PI/个吗？`);
                            if (confirmList) {
                                setTimeout(() => {
                                    alert(`上架成功！已将 ${numQuantity} 个万能方格上架出售。`);
                                }, 500);
                            }
                        }
                    }
                }
            });
            
            // 添加模态框事件监听器
            document.addEventListener('click', function(e) {
                if (e.target.id === 'universalSquaresBtn') showSquareDetailModal('universalSquares');
                if (e.target.id === 'coordinateSquaresBtn') showSquareDetailModal('coordinateSquares');
                if (e.target.id === 'universalSquaresBtn2') showSquareDetailModal('listedUniversalSquares');
                if (e.target.id === 'coordinateSquaresBtn2') showSquareDetailModal('listedCoordinateSquares');
            });
            
            // 添加购买和出售按钮事件监听器
            document.addEventListener('click', function(e) {
                // 购买功能
                if (e.target.classList.contains('purchase-btn')) {
                    const type = e.target.dataset.type;
                    const quantity = parseInt(e.target.dataset.quantity);
                    const price = parseFloat(e.target.dataset.price);
                    const totalCost = (quantity * price).toFixed(2);
                    
                    const confirmPurchase = confirm(`确定要购买 ${quantity} 个${type === 'universal' ? '万能方格' : '坐标方格'}吗？\n单价：${price} PI/个\n总价：${totalCost} PI`);
                    
                    if (confirmPurchase) {
                        setTimeout(() => {
                            alert(`购买成功！已购买 ${quantity} 个${type === 'universal' ? '万能方格' : '坐标方格'}，花费 ${totalCost} PI。`);
                        }, 500);
                    }
                }
                
                // 出售功能
                if (e.target.classList.contains('sell-btn')) {
                    const type = e.target.dataset.type;
                    const availableQuantity = parseInt(e.target.dataset.quantity);
                    
                    const sellQuantity = prompt(`请输入要出售的${type === 'universal' ? '万能方格' : '坐标方格'}数量（最多${availableQuantity}个）：`);
                    const numQuantity = parseInt(sellQuantity);
                    
                    if (sellQuantity && !isNaN(numQuantity) && numQuantity > 0 && numQuantity <= availableQuantity) {
                        const confirmSell = confirm(`确定要出售 ${numQuantity} 个${type === 'universal' ? '万能方格' : '坐标方格'}吗？`);
                        
                        if (confirmSell) {
                            setTimeout(() => {
                                alert(`出售成功！已出售 ${numQuantity} 个${type === 'universal' ? '万能方格' : '坐标方格'}。`);
                            }, 500);
                        }
                    }
                }
                
                // 参与预购
                if (e.target.textContent === '参与预购') {
                    const confirmPreorder = confirm('确定要参与预购吗？\n预购价格：7.5 PI/个\n可预购数量：3个');
                    
                    if (confirmPreorder) {
                        setTimeout(() => {
                            alert('预购申请已提交！请等待系统确认。');
                        }, 500);
                    }
                }
                
                // 关闭领地收益弹窗
                if (e.target.classList.contains('close-income-btn') || (e.target.parentElement && e.target.parentElement.classList.contains('close-income-btn'))) {
                    const modal = document.getElementById('infoModal');
                    const modalContent = document.getElementById('infoModalContent');
                    
                    // 添加关闭动画
                    modalContent.classList.remove('scale-100', 'opacity-100');
                    modalContent.classList.add('scale-95', 'opacity-0');
                    
                    setTimeout(() => {
                        modal.classList.add('hidden');
                    }, 300);
                }
                
                // 关闭股东收益弹窗
                if (e.target.classList.contains('close-shareholder-btn') || (e.target.parentElement && e.target.parentElement.classList.contains('close-shareholder-btn'))) {
                    const modal = document.getElementById('infoModal');
                    const modalContent = document.getElementById('infoModalContent');
                    
                    // 添加关闭动画
                    modalContent.classList.remove('scale-100', 'opacity-100');
                    modalContent.classList.add('scale-95', 'opacity-0');
                    
                    setTimeout(() => {
                        modal.classList.add('hidden');
                    }, 300);
                }
            });

            // 添加关闭按钮事件监听器
            document.querySelectorAll('.close-modal-btn').forEach(btn => {
                btn.addEventListener('click', hideSquareDetailModal);
            });
            
            // 点击模态框外部关闭
            document.getElementById('squareDetailModal').addEventListener('click', (e) => {
                if (e.target.id === 'squareDetailModal') {
                    hideSquareDetailModal();
                }
            });
        });

        // 签到按钮事件
        function setupSignInButton() {
            const signInButton = document.getElementById('signInButton');
            if (signInButton) {
                signInButton.addEventListener('click', function() {
                    // 生成随机坐标（在有效范围内）
                    const x = Math.floor(Math.random() * 180) + 10; // 10-189
                    const y = Math.floor(Math.random() * 180) + 10; // 10-189
                    
                    // 显示签到成功提示
                    const modal = document.createElement('div');
                    modal.className = 'fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50';
                    modal.innerHTML = `
                        <div class="bg-black rounded-lg p-6 border border-pi-yellow max-w-md w-full transform transition-all duration-300 scale-100 opacity-100" style="box-shadow: 0 0 30px rgba(255, 193, 7, 0.5);">
                            <div class="text-center">
                                <div class="text-pi-yellow text-5xl mb-4">
                                    <i class="fa fa-trophy"></i>
                                </div>
                                <h3 class="text-xl font-pixel text-pi-yellow mb-3">签到成功！</h3>
                                <p class="text-white mb-4">恭喜您获得一个像素方格！</p>
                                <div class="bg-gray-900 p-4 rounded-lg mb-4">
                                    <p class="text-gray-400 text-sm mb-1">坐标位置</p>
                                    <p class="text-white text-lg font-pixel">X: ${x}, Y: ${y}</p>
                                </div>
                                <button id="closeSignInModal" class="px-6 py-2 bg-pi-yellow text-black rounded-lg hover:bg-yellow-400 transition-colors duration-200 font-pixel text-sm">
                                    确定
                                </button>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(modal);
                    
                    // 关闭按钮事件
                    document.getElementById('closeSignInModal').addEventListener('click', function() {
                        modal.remove();
                    });
                    
                    // 更新用户方格数量
                    if (gameState && gameState.currentUser) {
                        gameState.currentUser.pixelCount++;
                    }
                    
                    // 更新状态显示
                    updateStatusDisplay();
                });
            }
        }
    </script>

</body></html>